#include <Arduino.h>
#include <TFT_eSPI.h>
#include <SPI.h>
#include <WiFi.h>
#include <HTTPClient.h>
#include "config.h"

TFT_eSPI tft = TFT_eSPI();

// BlackRoad Official Brand Colors (RGB565 format for TFT)
#define COLOR_BLACK       0x0000  // #000000 Pure Black
#define COLOR_WHITE       0xFFFF  // #FFFFFF Pure White
#define COLOR_SUNRISE     0xFCE0  // #FF9D00 Sunrise Orange
#define COLOR_WARM        0xFB40  // #FF6B00 Warm Orange
#define COLOR_HOT_PINK    0xF80C  // #FF0066 Hot Pink
#define COLOR_MAGENTA     0xF80D  // #FF006B Electric Magenta
#define COLOR_DEEP_MAG    0xD015  // #D600AA Deep Magenta
#define COLOR_VIVID_PUR   0x781F  // #7700FF Vivid Purple
#define COLOR_CYBER_BLUE  0x033F  // #0066FF Cyber Blue
#define COLOR_DARK_GRAY   0x2104  // #222222 Dark Gray

// Touch configuration for ESP32-2432S028R (XPT2046)
#define XPT2046_IRQ 36
#define XPT2046_MOSI 32
#define XPT2046_MISO 39
#define XPT2046_CLK 25
#define XPT2046_CS 33
#define TFT_BL 21

SPIClass touchSPI = SPIClass(VSPI);

// Screen definitions
enum Screen {
  SCREEN_LOCK,
  SCREEN_HOME,
  SCREEN_AI_INFERENCE,     // vLLM AI
  SCREEN_MESSAGES,         // BlackRoad Messages
  SCREEN_CRM,              // EspoCRM
  SCREEN_MESH_VPN,         // Headscale
  SCREEN_IDENTITY,         // Keycloak SSO
  SCREEN_FILES,            // File Manager
  SCREEN_APIS,             // API Management
  SCREEN_SETTINGS,
  SCREEN_CONTROL_CENTER,
  SCREEN_WORKFLOW,         // Universal Emoji Library (UEL v1)
  SCREEN_DECISIONS,        // Decision Cards (Template 1)
  SCREEN_CEO_DASHBOARD,    // CEO Dashboard (Template 2)
  SCREEN_CEO_CORE,         // 3Ã—3 CEO Core Grid
  SCREEN_EXEC_GRID,        // 4Ã—4 Exec Extended Grid
  SCREEN_BLACKROAD_CHAT,   // BlackRoad Proprietary AI Chat
  SCREEN_META,             // META - Aggregates ALL app data (ULTIMATE RECURSION!)
  SCREEN_TERMINAL,         // Terminal with command history (BETTER THAN iPHONE!)
  SCREEN_KEYBOARD          // Pop-up QWERTY keyboard (BETTER THAN iPHONE!)
};

Screen currentScreen = SCREEN_LOCK;
unsigned long lastTouchTime = 0;
bool isLocked = false;

// App icon structure
struct App {
  const char* name;
  uint16_t color;
  Screen screen;
  int x, y, size;
  int badge;  // Notification count
};

// BlackRoad OS + Emoji OS Apps (5Ã—3 compact grid = 15 apps, 50px icons)
App apps[] = {
  // Row 1 - Emoji OS
  {"CEO", COLOR_HOT_PINK, SCREEN_CEO_CORE, 15, 55, 50, 9},          // 3Ã—3 CEO Grid
  {"EXEC", COLOR_VIVID_PUR, SCREEN_EXEC_GRID, 75, 55, 50, 16},      // 4Ã—4 Exec Grid
  {"DECIDE", COLOR_MAGENTA, SCREEN_DECISIONS, 135, 55, 50, 3},      // Decision Cards
  {"META", COLOR_SUNRISE, SCREEN_META, 195, 55, 50, 15},            // META - ALL app data!
  {"WORK", COLOR_CYBER_BLUE, SCREEN_WORKFLOW, 255, 55, 50, 7},      // UEL Workflow

  // Row 2 - BlackRoad Services
  {"AI", COLOR_VIVID_PUR, SCREEN_AI_INFERENCE, 15, 115, 50, 0},     // vLLM Inference
  {"MSG", COLOR_HOT_PINK, SCREEN_MESSAGES, 75, 115, 50, 3},         // Messages
  {"CRM", COLOR_MAGENTA, SCREEN_CRM, 135, 115, 50, 12},             // EspoCRM
  {"VPN", COLOR_CYBER_BLUE, SCREEN_MESH_VPN, 195, 115, 50, 0},      // Headscale
  {"ID", COLOR_SUNRISE, SCREEN_IDENTITY, 255, 115, 50, 0},          // Keycloak

  // Row 3 - Utilities
  {"FILE", COLOR_WARM, SCREEN_FILES, 15, 175, 50, 45},              // Files
  {"API", COLOR_DEEP_MAG, SCREEN_APIS, 75, 175, 50, 4},             // APIs
  {"SET", COLOR_VIVID_PUR, SCREEN_SETTINGS, 135, 175, 50, 0},       // Settings
  {"CC", COLOR_DARK_GRAY, SCREEN_CONTROL_CENTER, 195, 175, 50, 0},  // Control Center
  {"CHAT", COLOR_HOT_PINK, SCREEN_BLACKROAD_CHAT, 255, 175, 50, 6}, // BlackRoad AI Chat

  // Row 4 - Terminal (BETTER THAN iPHONE!)
  {"TERM", COLOR_CYBER_BLUE, SCREEN_TERMINAL, 135, 230, 45, 0}      // SSH Terminal + Keyboard
};
const int APP_COUNT = 16;

// Decision Hub stats
int decisionCount = 0;
int hotCount = 0;
int notCount = 0;
int skipCount = 0;

// Emoji Grid stats (BETTER THAN iPHONE)
int approveCount = 0;
int rejectCount = 0;
int holdCount = 0;
int shipCount = 0;
int escalateCount = 0;
int criticalCount = 0;
int blockedCount = 0;
unsigned long lastActionTime = 0;

// RECURSIVE AI CHAT - Active model selection (0=Lucidia, 1=Aria, 2=Cadence, 3=Cecilia, 4=Octavia, 5=Alice)
int activeAI = 0;

// TERMINAL + KEYBOARD (BETTER THAN iPHONE!)
String terminalBuffer = "";           // Current command being typed
String terminalHistory[8] = {         // Last 8 commands with output
  "$ ssh lucidia",
  "> Connected to 192.168.4.38",
  "$ uptime",
  "> 14:23:45 up 7 days, 2:15, load: 0.52",
  "$ docker ps",
  "> 5 containers running",
  "$ echo 'BlackRoad OS Terminal'",
  "> BlackRoad OS Terminal"
};
int historyCount = 8;
bool keyboardVisible = false;         // Is keyboard overlay showing?
Screen screenBeforeKeyboard = SCREEN_HOME;  // Return to this screen after keyboard

// Haptic/Audio feedback (NO iPHONE HAS THIS!)
#define BUZZER_PIN 25  // Can use any available GPIO
void playBeep(int duration = 50) {
  tone(BUZZER_PIN, 2000, duration);  // 2kHz beep
}

void playSuccess() {
  tone(BUZZER_PIN, 1500, 50);
  delay(60);
  tone(BUZZER_PIN, 2000, 50);
}

void playCritical() {
  for(int i=0; i<3; i++) {
    tone(BUZZER_PIN, 3000, 30);
    delay(40);
  }
}

// Touch calibration
uint16_t readTouchX() {
  touchSPI.beginTransaction(SPISettings(2000000, MSBFIRST, SPI_MODE0));
  digitalWrite(XPT2046_CS, LOW);
  touchSPI.transfer(0x90);
  uint16_t x = touchSPI.transfer16(0x0000) >> 3;
  digitalWrite(XPT2046_CS, HIGH);
  touchSPI.endTransaction();
  return x;
}

uint16_t readTouchY() {
  touchSPI.beginTransaction(SPISettings(2000000, MSBFIRST, SPI_MODE0));
  digitalWrite(XPT2046_CS, LOW);
  touchSPI.transfer(0xD0);
  uint16_t y = touchSPI.transfer16(0x0000) >> 3;
  digitalWrite(XPT2046_CS, HIGH);
  touchSPI.endTransaction();
  return y;
}

bool getTouchCoordinates(int &x, int &y) {
  if (digitalRead(XPT2046_IRQ) == LOW) {
    uint16_t rawX = readTouchX();
    uint16_t rawY = readTouchY();
    x = map(rawX, 200, 3700, 0, 320);
    y = map(rawY, 200, 3700, 0, 240);  // FIXED: was (240, 0), now (0, 240)
    x = constrain(x, 0, 320);
    y = constrain(y, 0, 240);

    // DEBUG: Print raw and mapped coordinates
    Serial.printf("TOUCH DEBUG - Raw: (%d, %d) â†’ Mapped: (%d, %d)\n", rawX, rawY, x, y);

    return true;
  }
  return false;
}

// Enhanced status bar with gradient and icons (BETTER THAN iPHONE!)
void drawStatusBar() {
  // Gradient background (dark to darker)
  for (int i = 0; i < 20; i++) {
    uint16_t color = tft.color565(10 - i/2, 10 - i/2, 10 - i/2);
    tft.drawFastHLine(0, i, 320, color);
  }
  // Bottom highlight line
  tft.drawFastHLine(0, 19, 320, COLOR_CYBER_BLUE);

  // WiFi status with signal icon
  bool wifiConnected = WiFi.status() == WL_CONNECTED;
  tft.setTextColor(wifiConnected ? COLOR_CYBER_BLUE : 0x7BEF); // Cyan or gray
  tft.setTextDatum(TL_DATUM);

  // WiFi icon (signal bars)
  int signalX = 5;
  if (wifiConnected) {
    // 3 signal bars
    tft.fillRect(signalX, 14, 2, 4, COLOR_CYBER_BLUE);
    tft.fillRect(signalX + 3, 12, 2, 6, COLOR_CYBER_BLUE);
    tft.fillRect(signalX + 6, 10, 2, 8, COLOR_CYBER_BLUE);
  } else {
    // X mark
    tft.drawLine(signalX, 10, signalX + 8, 18, COLOR_HOT_PINK);
    tft.drawLine(signalX + 8, 10, signalX, 18, COLOR_HOT_PINK);
  }

  // WiFi text
  tft.setTextColor(COLOR_WHITE);
  tft.drawString(wifiConnected ? "WiFi" : "Offline", 18, 3, 1);

  // Time (using millis for now) with clock icon
  tft.setTextColor(COLOR_WHITE);
  tft.setTextDatum(TC_DATUM);
  unsigned long mins = (millis() / 60000) % 60;
  unsigned long hrs = (millis() / 3600000) % 24;
  char timeStr[6];
  sprintf(timeStr, "%02lu:%02lu", hrs, mins);

  // Clock icon
  tft.drawCircle(145, 10, 5, COLOR_VIVID_PUR);
  tft.drawLine(145, 10, 145, 7, COLOR_VIVID_PUR); // Hour hand
  tft.drawLine(145, 10, 147, 10, COLOR_VIVID_PUR); // Minute hand

  tft.drawString(timeStr, 168, 3, 2);

  // Battery indicator with icon and percentage
  int batteryPercent = 85 + ((millis() / 10000) % 15); // Simulate 85-100%
  tft.setTextDatum(TR_DATUM);

  // Battery icon
  int battX = 280;
  tft.drawRect(battX, 8, 22, 10, COLOR_WHITE);
  tft.fillRect(battX + 22, 11, 2, 4, COLOR_WHITE); // Terminal

  // Battery fill (based on percent)
  int fillWidth = (batteryPercent * 18) / 100;
  uint16_t fillColor = batteryPercent > 20 ? COLOR_SUNRISE : COLOR_HOT_PINK;
  if (fillWidth > 0) {
    tft.fillRect(battX + 2, 10, fillWidth, 6, fillColor);
  }

  // Battery percentage
  tft.setTextColor(COLOR_WHITE);
  char battStr[5];
  sprintf(battStr, "%d%%", batteryPercent);
  tft.drawString(battStr, 315, 3, 2);
}

// Draw app icon with notification badge (CIRCULAR!)
void drawAppIcon(App &app, bool pressed = false) {
  uint16_t fillColor = pressed ? COLOR_WHITE : app.color;
  uint16_t outlineColor = pressed ? app.color : COLOR_WHITE;

  // Draw circular app icon (BETTER THAN iPHONE!)
  int centerX = app.x + app.size/2;
  int centerY = app.y + app.size/2;
  int radius = app.size/2;

  tft.fillCircle(centerX, centerY, radius, fillColor);
  tft.drawCircle(centerX, centerY, radius, outlineColor);

  if (strlen(app.name) > 0) {
    tft.setTextColor(pressed ? app.color : COLOR_BLACK);
    tft.setTextDatum(MC_DATUM);
    tft.drawString(app.name, centerX, centerY, 2);
  }

  // Draw notification badge (at top-right of circle)
  if (app.badge > 0) {
    int badgeX = centerX + radius - 8;
    int badgeY = centerY - radius + 8;
    tft.fillCircle(badgeX, badgeY, 8, COLOR_HOT_PINK);
    tft.setTextColor(COLOR_WHITE);
    tft.setTextDatum(MC_DATUM);
    tft.drawString(String(app.badge), badgeX, badgeY, 1);
  }
}

// ==================== UI/UX ENHANCEMENTS ====================

// Enhanced back button with shadow and better visuals (BETTER THAN iPHONE!)
void drawBackButton(bool pressed = false) {
  int x = 10, y = 5, w = 50, h = 18;

  if (pressed) {
    // Pressed state - darker, no shadow
    tft.fillRoundRect(x, y, w, h, 5, COLOR_VIVID_PUR);
    tft.setTextColor(COLOR_WHITE);
  } else {
    // Normal state - with shadow
    // Shadow
    tft.fillRoundRect(x+2, y+2, w, h, 5, 0x18E3); // Dark shadow
    // Button
    tft.fillRoundRect(x, y, w, h, 5, COLOR_DARK_GRAY);
    // Highlight edge (3D effect)
    tft.drawFastHLine(x+3, y+1, w-6, 0x4208); // Top highlight
    tft.setTextColor(COLOR_CYBER_BLUE);
  }

  tft.setTextDatum(MC_DATUM);
  tft.drawString("< Back", x + w/2, y + h/2, 2);
}

// Enhanced button with shadow (universal component)
void drawButton(int x, int y, int w, int h, const char* text, uint16_t color, bool pressed = false) {
  if (pressed) {
    // Pressed state
    tft.fillRoundRect(x, y, w, h, 5, color);
    tft.setTextColor(COLOR_BLACK);
  } else {
    // Shadow
    tft.fillRoundRect(x+2, y+2, w, h, 5, 0x18E3);
    // Button
    tft.fillRoundRect(x, y, w, h, 5, color);
    // Highlight
    tft.drawFastHLine(x+3, y+1, w-6, TFT_WHITE);
    tft.setTextColor(COLOR_WHITE);
  }

  tft.setTextDatum(MC_DATUM);
  tft.drawString(text, x + w/2, y + h/2, 2);
}

// Section header with underline (for better content organization)
void drawSectionHeader(const char* text, int y, uint16_t color) {
  tft.setTextColor(color);
  tft.setTextDatum(TL_DATUM);
  tft.drawString(text, 10, y, 2);
  // Underline
  int textWidth = tft.textWidth(text, 2);
  tft.fillRect(10, y + 18, textWidth, 2, color);
}

// Status badge with icon (for connection status, etc.)
void drawStatusBadge(int x, int y, const char* text, bool active, uint16_t color) {
  int w = 70, h = 18;

  // Shadow
  tft.fillRoundRect(x+1, y+1, w, h, 3, 0x18E3);

  // Badge background
  if (active) {
    tft.fillRoundRect(x, y, w, h, 3, color);
    tft.setTextColor(COLOR_BLACK);
  } else {
    tft.fillRoundRect(x, y, w, h, 3, COLOR_DARK_GRAY);
    tft.setTextColor(0x7BEF); // Gray text
  }

  // Status dot
  tft.fillCircle(x + 8, y + h/2, 3, active ? COLOR_VIVID_PUR : 0x528A);

  // Text
  tft.setTextDatum(ML_DATUM);
  tft.drawString(text, x + 15, y + h/2, 1);
}

// Card container with shadow (for content sections)
void drawCard(int x, int y, int w, int h, uint16_t color = COLOR_DARK_GRAY) {
  // Shadow
  tft.fillRoundRect(x+3, y+3, w, h, 6, 0x18E3);
  // Card
  tft.fillRoundRect(x, y, w, h, 6, color);
  // Highlight edge
  tft.drawRoundRect(x, y, w, h, 6, 0x4208);
}

// Progress bar with percentage
void drawProgressBar(int x, int y, int w, int h, int percent, uint16_t color) {
  // Background
  tft.fillRoundRect(x, y, w, h, 3, COLOR_DARK_GRAY);

  // Progress fill
  int fillWidth = (w * percent) / 100;
  if (fillWidth > 0) {
    tft.fillRoundRect(x, y, fillWidth, h, 3, color);
  }

  // Percentage text
  char percentText[8];
  sprintf(percentText, "%d%%", percent);
  tft.setTextColor(COLOR_WHITE);
  tft.setTextDatum(MC_DATUM);
  tft.drawString(percentText, x + w/2, y + h/2, 1);
}

// Notification dot (for app badges)
void drawNotificationDot(int x, int y, int count) {
  if (count > 0) {
    // Shadow
    tft.fillCircle(x+1, y+1, 8, 0x18E3);
    // Dot
    tft.fillCircle(x, y, 8, COLOR_HOT_PINK);
    tft.drawCircle(x, y, 8, COLOR_WHITE);

    // Count
    tft.setTextColor(COLOR_WHITE);
    tft.setTextDatum(MC_DATUM);
    if (count < 10) {
      tft.drawString(String(count), x, y, 2);
    } else {
      tft.drawString("9+", x, y, 1);
    }
  }
}

// ==================== ANIMATIONS & TRANSITIONS ====================

// Ripple effect on touch (BETTER THAN iPHONE!)
void drawRipple(int x, int y, uint16_t color, int maxRadius = 30) {
  for (int r = 5; r <= maxRadius; r += 5) {
    tft.drawCircle(x, y, r, color);
    delay(20);
    tft.drawCircle(x, y, r, COLOR_BLACK); // Erase
  }
}

// Fade transition between screens
void fadeTransition(uint16_t fromColor, uint16_t toColor, int steps = 10) {
  // Extract RGB components
  uint8_t r1 = (fromColor >> 11) & 0x1F;
  uint8_t g1 = (fromColor >> 5) & 0x3F;
  uint8_t b1 = fromColor & 0x1F;

  uint8_t r2 = (toColor >> 11) & 0x1F;
  uint8_t g2 = (toColor >> 5) & 0x3F;
  uint8_t b2 = toColor & 0x1F;

  for (int i = 0; i <= steps; i++) {
    uint8_t r = r1 + ((r2 - r1) * i) / steps;
    uint8_t g = g1 + ((g2 - g1) * i) / steps;
    uint8_t b = b1 + ((b2 - b1) * i) / steps;

    uint16_t color = (r << 11) | (g << 5) | b;
    tft.fillScreen(color);
    delay(15);
  }
}

// Loading spinner (for future use)
void drawSpinner(int x, int y, uint16_t color, int frame) {
  const int radius = 15;
  const int dotCount = 8;

  for (int i = 0; i < dotCount; i++) {
    int angle = (i * 360 / dotCount + frame * 45) % 360;
    int dotX = x + cos(angle * PI / 180.0) * radius;
    int dotY = y + sin(angle * PI / 180.0) * radius;

    // Fade older dots
    uint16_t dotColor = color;
    if (i > 0) {
      int brightness = 255 - (i * 32);
      dotColor = tft.color565(brightness, brightness, brightness);
    }

    tft.fillCircle(dotX, dotY, 3, dotColor);
  }
}

// Slide-in animation for screens
void slideIn(int direction) {
  // direction: 0=left, 1=right, 2=up, 3=down
  // For now, just a quick visual effect
  for (int i = 0; i < 5; i++) {
    delay(10);
  }
}

// Pulse animation for notifications
void drawPulse(int x, int y, uint16_t color, int frame) {
  int radius = 8 + (frame % 5);
  uint8_t alpha = 255 - (frame % 5) * 50;

  tft.drawCircle(x, y, radius, color);
  if (radius > 8) {
    tft.drawCircle(x, y, radius - 1, COLOR_BLACK);
  }
}

// Toast notification system (BETTER THAN iPHONE!)
void showToast(const char* message, uint16_t color = COLOR_CYBER_BLUE, int duration = 2000) {
  int textWidth = tft.textWidth(message, 2);
  int toastWidth = textWidth + 40;
  int toastX = (320 - toastWidth) / 2;
  int toastY = 200;

  // Slide up animation
  for (int y = 240; y >= toastY; y -= 10) {
    // Shadow
    tft.fillRoundRect(toastX + 3, y + 3, toastWidth, 35, 8, 0x18E3);
    // Toast background
    tft.fillRoundRect(toastX, y, toastWidth, 35, 8, color);
    // Border
    tft.drawRoundRect(toastX, y, toastWidth, 35, 8, COLOR_WHITE);
    delay(20);
  }

  // Display message
  tft.setTextColor(COLOR_WHITE);
  tft.setTextDatum(MC_DATUM);
  tft.drawString(message, 160, toastY + 17, 2);

  delay(duration);

  // Slide down animation
  for (int y = toastY; y <= 240; y += 10) {
    tft.fillRect(toastX - 5, y - 5, toastWidth + 10, 45, COLOR_BLACK);
    delay(20);
  }
}

// Particle explosion effect (for emoji taps!)
void drawExplosion(int x, int y, uint16_t color) {
  for (int i = 0; i < 12; i++) {
    int angle = i * 30;
    int distance = 20;
    int px = x + cos(angle * PI / 180.0) * distance;
    int py = y + sin(angle * PI / 180.0) * distance;

    // Particle trail
    for (int j = 0; j < 5; j++) {
      int trailX = x + cos(angle * PI / 180.0) * (distance * j / 5);
      int trailY = y + sin(angle * PI / 180.0) * (distance * j / 5);
      tft.fillCircle(trailX, trailY, 3 - j/2, color);
    }
  }

  delay(100);

  // Clear explosion
  tft.fillCircle(x, y, 25, COLOR_BLACK);
}

// Screen flash effect (for critical actions)
void flashScreen(uint16_t color, int times = 3) {
  for (int i = 0; i < times; i++) {
    tft.fillScreen(color);
    delay(50);
    tft.fillScreen(COLOR_BLACK);
    delay(50);
  }
}

// Live bar chart animation
void drawLiveBarChart(int x, int y, int bars, const char* label, uint16_t color) {
  // Animated bars that grow
  for (int i = 0; i < bars; i++) {
    int barX = x + i * 25;
    int maxHeight = 40 + (i * 10);
    int currentHeight = (maxHeight * ((millis() / 100) % 100)) / 100;

    // Shadow
    tft.fillRect(barX + 2, y + 2 - currentHeight, 18, currentHeight, 0x18E3);
    // Bar
    tft.fillRect(barX, y - currentHeight, 18, currentHeight, color);
    // Border
    tft.drawRect(barX, y - currentHeight, 18, currentHeight, COLOR_WHITE);
  }

  // Label
  tft.setTextColor(COLOR_WHITE);
  tft.setTextDatum(TL_DATUM);
  tft.drawString(label, x, y + 5, 1);
}

// Waveform animation (for audio/data visualization)
void drawWaveform(int x, int y, int width, uint16_t color) {
  for (int i = 0; i < width; i += 3) {
    int amplitude = 15 + sin((millis() / 100.0 + i / 10.0)) * 10;
    int waveY = y + sin((millis() / 50.0 + i / 5.0)) * amplitude;

    tft.fillCircle(x + i, waveY, 2, color);
  }
}

// ==================== SCREENS ====================

void drawLockScreen() {
  tft.fillScreen(COLOR_BLACK);

  // Animated gradient background
  for (int i = 0; i < 240; i += 20) {
    uint16_t color = tft.color565(i/12, i/24, i/12);
    tft.drawFastHLine(0, i, 320, color);
  }

  // Large logo with shadow
  tft.setTextDatum(MC_DATUM);

  // Shadow
  tft.setTextColor(0x18E3);
  tft.drawString("BLACKROAD", 162, 82, 4);
  tft.drawString("AI PHONE", 162, 112, 4);

  // Logo
  tft.setTextColor(COLOR_SUNRISE);
  tft.drawString("BLACKROAD", 160, 80, 4);
  tft.setTextColor(COLOR_VIVID_PUR);
  tft.drawString("AI PHONE", 160, 110, 4);

  // Animated pulsing line
  int pulseWidth = 50 + (millis() / 100) % 100;
  tft.fillRect((320 - pulseWidth) / 2, 145, pulseWidth, 2, COLOR_CYBER_BLUE);

  // Version info
  tft.setTextColor(0x7BEF); // Gray
  tft.drawString("v2.3 ULTIMATE", 160, 160, 1);

  // Tap to unlock indicator with glow
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("Tap Anywhere to Unlock", 160, 195, 2);

  // Animated touch indicator (pulsing circle)
  int pulseRadius = 8 + (millis() / 200) % 8;
  tft.fillCircle(160, 220, 8, COLOR_VIVID_PUR);
  tft.drawCircle(160, 220, pulseRadius, COLOR_CYBER_BLUE);
  tft.drawCircle(160, 220, pulseRadius + 2, COLOR_HOT_PINK);
}

void drawHomeScreen() {
  tft.fillScreen(COLOR_BLACK);
  drawStatusBar();

  // Enhanced branding with shadow and underline
  tft.setTextDatum(TC_DATUM);

  // Shadow
  tft.setTextColor(0x18E3);
  tft.drawString("BLACKROAD OS", 161, 29, 2);

  // Main text
  tft.setTextColor(COLOR_SUNRISE);
  tft.drawString("BLACKROAD OS", 160, 28, 2);

  // Animated underline
  int lineWidth = 80 + (millis() / 100) % 20;
  int lineX = (320 - lineWidth) / 2;
  tft.fillRect(lineX, 42, lineWidth, 2, COLOR_CYBER_BLUE);

  // Version badge
  tft.fillRoundRect(230, 24, 80, 16, 3, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_VIVID_PUR);
  tft.setTextDatum(MC_DATUM);
  tft.drawString("v2.3 ULT", 270, 32, 1);

  // Draw app icons with shadows!
  for (int i = 0; i < APP_COUNT; i++) {
    if (strlen(apps[i].name) > 0) {
      // Shadow for app icon
      int centerX = apps[i].x + apps[i].size/2;
      int centerY = apps[i].y + apps[i].size/2;
      int radius = apps[i].size/2;
      tft.fillCircle(centerX + 2, centerY + 2, radius, 0x18E3);

      // App icon
      drawAppIcon(apps[i]);
    }
  }
}

void drawAIInference() {
  tft.fillScreen(COLOR_BLACK);
  drawStatusBar();

  // Title
  tft.setTextColor(COLOR_VIVID_PUR);
  tft.setTextDatum(TC_DATUM);
  tft.drawString("AI INFERENCE", 160, 27, 2);

  // GPU Stats (small, top-right)
  tft.setTextColor(COLOR_SUNRISE);
  tft.setTextDatum(TR_DATUM);
  tft.drawString("GPU:84%", 305, 27, 1);
  tft.drawString("MEM:67%", 305, 36, 1);

  // 5 Model rows (compact)
  int y = 48;
  // Model 1 - RUNNING
  tft.fillRoundRect(10, y, 300, 18, 3, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_VIVID_PUR); tft.setTextDatum(TL_DATUM);
  tft.drawString("Qwen2.5-7B", 13, y+4, 1);
  tft.setTextColor(COLOR_WHITE); tft.setTextDatum(TR_DATUM);
  tft.drawString("RUN 45t/s", 307, y+4, 1);

  // Model 2 - RUNNING
  y += 20;
  tft.fillRoundRect(10, y, 300, 18, 3, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_HOT_PINK); tft.setTextDatum(TL_DATUM);
  tft.drawString("Llama-3-8B", 13, y+4, 1);
  tft.setTextColor(COLOR_WHITE); tft.setTextDatum(TR_DATUM);
  tft.drawString("RUN 38t/s", 307, y+4, 1);

  // Model 3 - QUEUED
  y += 20;
  tft.fillRoundRect(10, y, 300, 18, 3, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_CYBER_BLUE); tft.setTextDatum(TL_DATUM);
  tft.drawString("Phi-2-2.7B", 13, y+4, 1);
  tft.setTextColor(COLOR_SUNRISE); tft.setTextDatum(TR_DATUM);
  tft.drawString("QUEUE:3", 307, y+4, 1);

  // Model 4 - STANDBY
  y += 20;
  tft.fillRoundRect(10, y, 300, 18, 3, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_WARM); tft.setTextDatum(TL_DATUM);
  tft.drawString("Mistral-7B", 13, y+4, 1);
  tft.setTextColor(COLOR_WHITE); tft.setTextDatum(TR_DATUM);
  tft.drawString("STANDBY", 307, y+4, 1);

  // Model 5 - STANDBY
  y += 20;
  tft.fillRoundRect(10, y, 300, 18, 3, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_MAGENTA); tft.setTextDatum(TL_DATUM);
  tft.drawString("Claude-3.5", 13, y+4, 1);
  tft.setTextColor(COLOR_WHITE); tft.setTextDatum(TR_DATUM);
  tft.drawString("STANDBY", 307, y+4, 1);

  // Detailed Stats (3 columns)
  y += 28;
  tft.setTextColor(COLOR_WHITE); tft.setTextDatum(TL_DATUM);
  tft.drawString("Req:", 10, y, 1);
  tft.setTextColor(COLOR_VIVID_PUR);
  tft.drawString("2,847", 35, y, 1);

  tft.setTextColor(COLOR_WHITE);
  tft.drawString("Queue:", 85, y, 1);
  tft.setTextColor(COLOR_SUNRISE);
  tft.drawString("12", 120, y, 1);

  tft.setTextColor(COLOR_WHITE);
  tft.drawString("Err:", 145, y, 1);
  tft.setTextColor(COLOR_HOT_PINK);
  tft.drawString("3", 170, y, 1);

  // Second row of stats
  y += 12;
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("Avg:", 10, y, 1);
  tft.setTextColor(COLOR_CYBER_BLUE);
  tft.drawString("1.2s", 35, y, 1);

  tft.setTextColor(COLOR_WHITE);
  tft.drawString("P95:", 85, y, 1);
  tft.setTextColor(COLOR_CYBER_BLUE);
  tft.drawString("2.8s", 110, y, 1);

  tft.setTextColor(COLOR_WHITE);
  tft.drawString("Uptime:", 145, y, 1);
  tft.setTextColor(COLOR_VIVID_PUR);
  tft.drawString("99.8%", 180, y, 1);

  // GPU utilization bar
  y += 18;
  tft.setTextColor(COLOR_SUNRISE); tft.setTextDatum(TL_DATUM);
  tft.drawString("GPU Utilization", 10, y, 1);
  tft.drawRect(10, y+10, 280, 10, COLOR_WHITE);
  tft.fillRect(11, y+11, 235, 8, COLOR_VIVID_PUR); // 84% of 280

  // Memory bar
  y += 24;
  tft.setTextColor(COLOR_HOT_PINK);
  tft.drawString("VRAM Usage", 10, y, 1);
  tft.drawRect(10, y+10, 280, 10, COLOR_WHITE);
  tft.fillRect(11, y+11, 188, 8, COLOR_HOT_PINK); // 67% of 280

  // Endpoint
  tft.setTextColor(COLOR_WHITE);
  tft.setTextDatum(MC_DATUM);
  tft.drawString("ai.blackroad.io/v1/chat", 160, 223, 1);

  drawBackButton();
}

void drawDecisionHub() {
  tft.fillScreen(COLOR_BLACK);
  drawStatusBar();

  // Title
  tft.setTextColor(COLOR_HOT_PINK);
  tft.setTextDatum(TC_DATUM);
  tft.drawString("DECISION HUB", 160, 30, 4);

  // Buttons
  tft.fillRoundRect(20, 70, 80, 60, 10, COLOR_HOT_PINK);
  tft.fillRoundRect(120, 70, 80, 60, 10, COLOR_CYBER_BLUE);
  tft.fillRoundRect(220, 70, 80, 60, 10, COLOR_SUNRISE);

  tft.setTextColor(COLOR_BLACK);
  tft.setTextDatum(MC_DATUM);
  tft.drawString("HOT", 60, 100, 4);
  tft.drawString("NOT", 160, 100, 4);
  tft.drawString("SKIP", 260, 100, 4);

  // Stats
  tft.setTextColor(COLOR_WHITE);
  tft.setTextDatum(TL_DATUM);
  tft.drawString("Total: " + String(decisionCount), 20, 150, 2);
  tft.setTextColor(COLOR_HOT_PINK);
  tft.drawString("Hot: " + String(hotCount), 20, 170, 2);
  tft.setTextColor(COLOR_CYBER_BLUE);
  tft.drawString("Not: " + String(notCount), 20, 190, 2);
  tft.setTextColor(COLOR_SUNRISE);
  tft.drawString("Skip: " + String(skipCount), 20, 210, 2);

  drawBackButton();
}

void drawNetworkScreen() {
  tft.fillScreen(COLOR_BLACK);
  drawStatusBar();

  // Title
  tft.setTextColor(COLOR_CYBER_BLUE);
  tft.setTextDatum(TC_DATUM);
  tft.drawString("NETWORK", 160, 30, 4);

  // WiFi info
  tft.setTextColor(COLOR_WHITE);
  tft.setTextDatum(TL_DATUM);
  if (WiFi.status() == WL_CONNECTED) {
    tft.drawString("IP: " + WiFi.localIP().toString(), 10, 60, 2);
    tft.drawString("Network: " + String(WIFI_SSID), 10, 80, 2);
  } else {
    tft.drawString("WiFi: Disconnected", 10, 60, 2);
  }

  // SSH Nodes
  tft.setTextColor(COLOR_SUNRISE);
  tft.drawString("SSH NODES:", 10, 110, 2);

  tft.setTextColor(COLOR_WHITE);
  for (int i = 0; i < SSH_NODE_COUNT && i < 5; i++) {
    tft.drawString("â€¢ " + String(sshNodes[i].name), 10, 130 + (i * 15), 1);
  }

  drawBackButton();
}

// SETTINGS - MASSIVELY EXTENDED! System metrics, hardware info, network stats! (BETTER THAN iPHONE!)
void drawSettingsScreen() {
  tft.fillScreen(COLOR_BLACK);
  drawStatusBar();

  // Title
  tft.setTextColor(COLOR_VIVID_PUR);
  tft.setTextDatum(TC_DATUM);
  tft.drawString("SETTINGS", 160, 27, 2);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("BlackRoad OS v1.9", 160, 42, 1);

  // System stats header
  int y = 56;
  tft.setTextDatum(TL_DATUM);
  tft.setTextColor(COLOR_SUNRISE);
  tft.drawString("System:", 10, y, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("ESP32 @ 240MHz | 320KB RAM", 60, y, 1);

  // Hardware metrics (compact!)
  y += 16;

  // CPU & Memory
  tft.fillRoundRect(10, y, 300, 18, 4, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_VIVID_PUR); tft.setTextDatum(TL_DATUM);
  tft.drawString("CPU", 14, y+4, 2);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("240MHz", 60, y+5, 1);
  tft.drawString("RAM: 44KB/320KB", 130, y+5, 1);
  tft.setTextColor(COLOR_SUNRISE);
  tft.setTextDatum(TR_DATUM);
  tft.drawString("13.6%", 306, y+5, 1);

  // Flash & Firmware
  y += 22;
  tft.fillRoundRect(10, y, 300, 18, 4, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_HOT_PINK); tft.setTextDatum(TL_DATUM);
  tft.drawString("FLASH", 14, y+4, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("813KB/1.2MB", 60, y+5, 1);
  tft.drawString("v1.9 (2026-01-03)", 160, y+5, 1);
  tft.setTextColor(COLOR_SUNRISE);
  tft.setTextDatum(TR_DATUM);
  tft.drawString("62.1%", 306, y+5, 1);

  // Network & WiFi
  y += 22;
  tft.fillRoundRect(10, y, 300, 18, 4, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_CYBER_BLUE); tft.setTextDatum(TL_DATUM);
  tft.drawString("WiFi", 14, y+4, 2);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString(String(WIFI_SSID), 60, y+5, 1);
  tft.setTextColor(COLOR_SUNRISE);
  tft.drawString("192.168.4.XXX", 170, y+5, 1);
  tft.fillCircle(302, y+9, 3, COLOR_CYBER_BLUE); // Connected

  // Device ID & MAC
  y += 22;
  tft.fillRoundRect(10, y, 300, 18, 4, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_WARM); tft.setTextDatum(TL_DATUM);
  tft.drawString("ID", 14, y+4, 2);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("ceo-hub-esp32", 60, y+5, 1);
  tft.setTextColor(COLOR_VIVID_PUR);
  tft.drawString("20:e7:c8:ba:1b:94", 180, y+5, 1);

  // SSH Nodes
  y += 22;
  tft.fillRoundRect(10, y, 300, 18, 4, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_MAGENTA); tft.setTextDatum(TL_DATUM);
  tft.drawString("SSH", 14, y+4, 2);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString(String(SSH_NODE_COUNT) + " nodes", 60, y+5, 1);
  tft.setTextColor(COLOR_SUNRISE);
  tft.drawString("lucidia,octavia,alice...", 130, y+5, 1);

  // Uptime & Power
  y += 22;
  tft.fillRoundRect(10, y, 300, 18, 4, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_SUNRISE); tft.setTextDatum(TL_DATUM);
  tft.drawString("PWR", 14, y+4, 2);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("USB 5V", 60, y+5, 1);
  tft.drawString("Uptime: 8h 24m", 130, y+5, 1);
  tft.setTextColor(COLOR_VIVID_PUR);
  tft.setTextDatum(TR_DATUM);
  tft.drawString("500mA", 306, y+5, 1);

  // Display & Touch
  y += 22;
  tft.fillRoundRect(10, y, 300, 18, 4, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_VIVID_PUR); tft.setTextDatum(TL_DATUM);
  tft.drawString("LCD", 14, y+4, 2);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("320Ã—240 ILI9341", 60, y+5, 1);
  tft.setTextColor(COLOR_SUNRISE);
  tft.drawString("XPT2046 Touch", 180, y+5, 1);

  // Bottom stats - Sovereignty!
  tft.setTextColor(COLOR_HOT_PINK); tft.setTextDatum(TC_DATUM);
  tft.drawString("SOVEREIGN", 80, 220, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("|", 150, 220, 1);
  tft.setTextColor(COLOR_VIVID_PUR);
  tft.drawString("25 REPOS FORKED", 250, 220, 1);

  drawBackButton();
}

// CRM - MASSIVELY EXTENDED! Pipeline analytics, conversion rates, win rate! (BETTER THAN iPHONE!)
void drawCRMScreen() {
  tft.fillScreen(COLOR_BLACK);
  drawStatusBar();

  // Title
  tft.setTextColor(COLOR_MAGENTA);
  tft.setTextDatum(TC_DATUM);
  tft.drawString("CRM", 160, 27, 2);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("SuiteCRM Pipeline", 160, 42, 1);

  // Pipeline header
  int y = 56;
  tft.setTextDatum(TL_DATUM);
  tft.setTextColor(COLOR_SUNRISE);
  tft.drawString("Pipeline:", 10, y, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("$626K (33 deals) | 48% win", 60, y, 1);

  // Pipeline stages with conversion rates (compact!)
  y += 16;

  // Stage 1: LEAD (15 deals, $245K)
  tft.fillRoundRect(10, y, 300, 18, 4, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_SUNRISE); tft.setTextDatum(TL_DATUM);
  tft.drawString("LEAD", 14, y+4, 2);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("15", 70, y+5, 1);
  tft.drawString("$245K", 100, y+5, 1);
  tft.setTextColor(COLOR_VIVID_PUR);
  tft.drawString("53%â†’", 155, y+5, 1);
  tft.fillRect(200, y+7, 45, 4, COLOR_SUNRISE); // Progress bar
  tft.setTextDatum(TR_DATUM);
  tft.drawString("53%", 306, y+5, 1);

  // Stage 2: CONTACT (8 deals, $189K)
  y += 22;
  tft.fillRoundRect(10, y, 300, 18, 4, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_VIVID_PUR); tft.setTextDatum(TL_DATUM);
  tft.drawString("CONTACT", 14, y+4, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("8", 70, y+5, 1);
  tft.drawString("$189K", 100, y+5, 1);
  tft.setTextColor(COLOR_CYBER_BLUE);
  tft.drawString("75%â†’", 155, y+5, 1);
  tft.fillRect(200, y+7, 64, 4, COLOR_VIVID_PUR);
  tft.setTextDatum(TR_DATUM);
  tft.drawString("75%", 306, y+5, 1);

  // Stage 3: PROPOSAL (6 deals, $147K)
  y += 22;
  tft.fillRoundRect(10, y, 300, 18, 4, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_CYBER_BLUE); tft.setTextDatum(TL_DATUM);
  tft.drawString("PROPOSAL", 14, y+4, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("6", 70, y+5, 1);
  tft.drawString("$147K", 100, y+5, 1);
  tft.setTextColor(COLOR_HOT_PINK);
  tft.drawString("67%â†’", 155, y+5, 1);
  tft.fillRect(200, y+7, 57, 4, COLOR_CYBER_BLUE);
  tft.setTextDatum(TR_DATUM);
  tft.drawString("67%", 306, y+5, 1);

  // Stage 4: CLOSED-WON (4 deals, $45K)
  y += 22;
  tft.fillRoundRect(10, y, 300, 18, 4, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_HOT_PINK); tft.setTextDatum(TL_DATUM);
  tft.drawString("WON", 14, y+4, 2);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("4", 70, y+5, 1);
  tft.drawString("$45K", 100, y+5, 1);
  tft.setTextColor(COLOR_SUNRISE);
  tft.drawString("AVG:$11K", 155, y+5, 1);
  tft.fillRect(200, y+7, 85, 4, COLOR_HOT_PINK);
  tft.setTextDatum(TR_DATUM);
  tft.drawString("100%", 306, y+5, 1);

  // Recent activity feed (compact)
  y += 26;
  tft.setTextColor(COLOR_MAGENTA); tft.setTextDatum(TL_DATUM);
  tft.drawString("Recent Activity:", 10, y, 1);

  y += 14;
  // Activity 1: Acme Corp moved to Proposal
  tft.setTextColor(COLOR_VIVID_PUR);
  tft.drawString("Acme Corp", 14, y, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("â†’ PROPOSAL ($185K)", 90, y, 1);
  tft.setTextColor(COLOR_SUNRISE);
  tft.setTextDatum(TR_DATUM);
  tft.drawString("2h", 306, y, 1);

  // Activity 2: GlobalSys call completed
  y += 14;
  tft.setTextColor(COLOR_CYBER_BLUE); tft.setTextDatum(TL_DATUM);
  tft.drawString("GlobalSys", 14, y, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("Call completed", 90, y, 1);
  tft.setTextColor(COLOR_SUNRISE);
  tft.setTextDatum(TR_DATUM);
  tft.drawString("5h", 306, y, 1);

  // Activity 3: New lead: DataFlow LLC
  y += 14;
  tft.setTextColor(COLOR_HOT_PINK); tft.setTextDatum(TL_DATUM);
  tft.drawString("DataFlow", 14, y, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("New lead ($38K)", 90, y, 1);
  tft.setTextColor(COLOR_SUNRISE);
  tft.setTextDatum(TR_DATUM);
  tft.drawString("1d", 306, y, 1);

  // Bottom stats - Win rate & velocity
  tft.setTextColor(COLOR_HOT_PINK); tft.setTextDatum(TC_DATUM);
  tft.drawString("48% WIN", 70, 220, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("|", 130, 220, 1);
  tft.setTextColor(COLOR_VIVID_PUR);
  tft.drawString("14d AVG CLOSE", 235, 220, 1);

  drawBackButton();
}

// MESH VPN - MASSIVELY EXTENDED! Bandwidth, latency, encryption! (BETTER THAN iPHONE!)
void drawMeshVPN() {
  tft.fillScreen(COLOR_BLACK);
  drawStatusBar();

  // Title
  tft.setTextColor(COLOR_CYBER_BLUE);
  tft.setTextDatum(TC_DATUM);
  tft.drawString("MESH VPN", 160, 27, 2);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("Headscale WireGuard Mesh", 160, 42, 1);

  // Network stats header
  int y = 56;
  tft.setTextDatum(TL_DATUM);
  tft.setTextColor(COLOR_SUNRISE);
  tft.drawString("Network:", 10, y, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("100.64.0.0/10 | AES-256", 70, y, 1);

  // 4 Connected nodes with detailed stats (compact!)
  y += 16;

  // Node 1: LUCIDIA - Strategic server
  tft.fillRoundRect(10, y, 300, 20, 4, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_VIVID_PUR); tft.setTextDatum(TL_DATUM);
  tft.drawString("LUCIDIA", 14, y+4, 2);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("192.168.4.38", 80, y+6, 1);
  tft.setTextColor(COLOR_SUNRISE);
  tft.drawString("12ms", 170, y+6, 1);
  tft.setTextColor(COLOR_CYBER_BLUE);
  tft.drawString("2.4MB/s", 215, y+6, 1);
  tft.fillCircle(302, y+10, 4, COLOR_VIVID_PUR); // Online dot

  // Node 2: OCTAVIA - Security hub
  y += 24;
  tft.fillRoundRect(10, y, 300, 20, 4, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_WARM); tft.setTextDatum(TL_DATUM);
  tft.drawString("OCTAVIA", 14, y+4, 2);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("192.168.4.64", 80, y+6, 1);
  tft.setTextColor(COLOR_SUNRISE);
  tft.drawString("8ms", 170, y+6, 1);
  tft.setTextColor(COLOR_CYBER_BLUE);
  tft.drawString("5.1MB/s", 215, y+6, 1);
  tft.fillCircle(302, y+10, 4, COLOR_WARM);

  // Node 3: ALICE - Operations node
  y += 24;
  tft.fillRoundRect(10, y, 300, 20, 4, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_HOT_PINK); tft.setTextDatum(TL_DATUM);
  tft.drawString("ALICE", 14, y+4, 2);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("192.168.4.49", 80, y+6, 1);
  tft.setTextColor(COLOR_SUNRISE);
  tft.drawString("15ms", 170, y+6, 1);
  tft.setTextColor(COLOR_CYBER_BLUE);
  tft.drawString("1.8MB/s", 215, y+6, 1);
  tft.fillCircle(302, y+10, 4, COLOR_HOT_PINK);

  // Node 4: SHELLFISH - Cloud gateway
  y += 24;
  tft.fillRoundRect(10, y, 300, 20, 4, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_CYBER_BLUE); tft.setTextDatum(TL_DATUM);
  tft.drawString("SHELLFISH", 14, y+4, 2);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("192.168.4.99", 80, y+6, 1);
  tft.setTextColor(COLOR_SUNRISE);
  tft.drawString("24ms", 170, y+6, 1);
  tft.setTextColor(COLOR_CYBER_BLUE);
  tft.drawString("890KB/s", 215, y+6, 1);
  tft.fillCircle(302, y+10, 4, COLOR_CYBER_BLUE);

  // Network totals
  y += 28;
  tft.setTextColor(COLOR_CYBER_BLUE); tft.setTextDatum(TC_DATUM);
  tft.drawString("TOTAL BANDWIDTH", 90, y, 1);
  tft.setTextColor(COLOR_SUNRISE);
  tft.drawString("9.4 MB/s", 220, y, 2);

  // Bottom stats
  tft.setTextColor(COLOR_HOT_PINK); tft.setTextDatum(TC_DATUM);
  tft.drawString("4 NODES ONLINE", 100, 220, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("|", 180, 220, 1);
  tft.setTextColor(COLOR_VIVID_PUR);
  tft.drawString("ENCRYPTED", 245, 220, 1);

  drawBackButton();
}

// IDENTITY - MASSIVELY EXTENDED! OAuth, permissions, login history! (BETTER THAN iPHONE!)
void drawIdentity() {
  tft.fillScreen(COLOR_BLACK);
  drawStatusBar();

  // Title
  tft.setTextColor(COLOR_SUNRISE);
  tft.setTextDatum(TC_DATUM);
  tft.drawString("IDENTITY", 160, 27, 2);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("Keycloak SSO", 160, 42, 1);

  // User badge
  int y = 56;
  tft.fillRoundRect(10, y, 300, 24, 6, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_SUNRISE); tft.setTextDatum(TL_DATUM);
  tft.drawString("alexa@blackroad.io", 14, y+4, 2);
  tft.setTextColor(COLOR_VIVID_PUR);
  tft.setTextDatum(TR_DATUM);
  tft.drawString("ADMIN", 306, y+8, 1);

  // 5 Active sessions (compact!)
  y += 32;
  tft.setTextColor(COLOR_WHITE); tft.setTextDatum(TL_DATUM);
  tft.drawString("Sessions (5 active):", 10, y, 1);
  y += 14;

  // Session 1: CEO Phone (this device)
  tft.fillRoundRect(10, y, 300, 18, 4, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_HOT_PINK);
  tft.drawString("CEO Phone", 14, y+4, 2);
  tft.setTextColor(COLOR_SUNRISE);
  tft.setTextDatum(TR_DATUM);
  tft.drawString("NOW", 306, y+5, 1);

  // Session 2: MacBook Pro
  y += 22;
  tft.fillRoundRect(10, y, 300, 18, 4, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_VIVID_PUR); tft.setTextDatum(TL_DATUM);
  tft.drawString("MacBook Pro", 14, y+4, 2);
  tft.setTextColor(COLOR_WHITE);
  tft.setTextDatum(TR_DATUM);
  tft.drawString("2h ago", 306, y+5, 1);

  // Session 3: iPad Air
  y += 22;
  tft.fillRoundRect(10, y, 300, 18, 4, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_CYBER_BLUE); tft.setTextDatum(TL_DATUM);
  tft.drawString("iPad Air", 14, y+4, 2);
  tft.setTextColor(COLOR_WHITE);
  tft.setTextDatum(TR_DATUM);
  tft.drawString("5h ago", 306, y+5, 1);

  // Session 4: Chrome (lucidia)
  y += 22;
  tft.fillRoundRect(10, y, 300, 18, 4, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_MAGENTA); tft.setTextDatum(TL_DATUM);
  tft.drawString("Chrome (lucidia)", 14, y+4, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.setTextDatum(TR_DATUM);
  tft.drawString("1d ago", 306, y+5, 1);

  // Session 5: Mobile (iPhone)
  y += 22;
  tft.fillRoundRect(10, y, 300, 18, 4, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_WARM); tft.setTextDatum(TL_DATUM);
  tft.drawString("Mobile (iPhone)", 14, y+4, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.setTextDatum(TR_DATUM);
  tft.drawString("2d ago", 306, y+5, 1);

  // Bottom stats - OAuth & permissions
  tft.setTextColor(COLOR_HOT_PINK); tft.setTextDatum(TC_DATUM);
  tft.drawString("OAuth2 + OIDC", 90, 220, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("|", 170, 220, 1);
  tft.setTextColor(COLOR_VIVID_PUR);
  tft.drawString("FULL ADMIN", 245, 220, 1);

  drawBackButton();
}

// FILES - MASSIVELY EXTENDED! File sizes, types, categories! (BETTER THAN iPHONE!)
void drawFiles() {
  tft.fillScreen(COLOR_BLACK);
  drawStatusBar();

  // Title
  tft.setTextColor(COLOR_WARM);
  tft.setTextDatum(TC_DATUM);
  tft.drawString("FILES", 160, 27, 2);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("BlackRoad Cloud Storage", 160, 42, 1);

  // Storage bar
  int y = 56;
  tft.setTextDatum(TL_DATUM);
  tft.setTextColor(COLOR_SUNRISE);
  tft.drawString("Storage:", 10, y, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("2.3GB / 100GB (2.3%)", 70, y, 1);

  // 7 Recent files with sizes and types (compact!)
  y += 16;

  // File 1: BlackRoad OS docs (MD, 847KB, 2min ago)
  tft.fillRoundRect(10, y, 300, 18, 4, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_VIVID_PUR); tft.setTextDatum(TL_DATUM);
  tft.drawString("BLACKROAD_OS_v2.md", 14, y+4, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.setTextDatum(TR_DATUM);
  tft.drawString("847KB", 306, y+5, 1);

  // File 2: AI Phone Guide (MD, 2.1MB, 1h ago)
  y += 22;
  tft.fillRoundRect(10, y, 300, 18, 4, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_HOT_PINK); tft.setTextDatum(TL_DATUM);
  tft.drawString("AI_PHONE_GUIDE.md", 14, y+4, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.setTextDatum(TR_DATUM);
  tft.drawString("2.1MB", 306, y+5, 1);

  // File 3: ESP32 firmware (ZIP, 12.4MB, 3h ago)
  y += 22;
  tft.fillRoundRect(10, y, 300, 18, 4, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_CYBER_BLUE); tft.setTextDatum(TL_DATUM);
  tft.drawString("ceo-hub-esp32.zip", 14, y+4, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.setTextDatum(TR_DATUM);
  tft.drawString("12.4MB", 306, y+5, 1);

  // File 4: Deployment guide (PDF, 3.8MB, 5h ago)
  y += 22;
  tft.fillRoundRect(10, y, 300, 18, 4, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_SUNRISE); tft.setTextDatum(TL_DATUM);
  tft.drawString("deploy-guide.pdf", 14, y+4, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.setTextDatum(TR_DATUM);
  tft.drawString("3.8MB", 306, y+5, 1);

  // File 5: CRM export (JSON, 456KB, 1d ago)
  y += 22;
  tft.fillRoundRect(10, y, 300, 18, 4, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_MAGENTA); tft.setTextDatum(TL_DATUM);
  tft.drawString("crm-export.json", 14, y+4, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.setTextDatum(TR_DATUM);
  tft.drawString("456KB", 306, y+5, 1);

  // File 6: Screenshots (PNG, 8.2MB, 1d ago)
  y += 22;
  tft.fillRoundRect(10, y, 300, 18, 4, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_VIVID_PUR); tft.setTextDatum(TL_DATUM);
  tft.drawString("screenshots.zip", 14, y+4, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.setTextDatum(TR_DATUM);
  tft.drawString("8.2MB", 306, y+5, 1);

  // File 7: Codebase backup (TAR, 124MB, 2d ago)
  y += 22;
  tft.fillRoundRect(10, y, 300, 18, 4, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_WARM); tft.setTextDatum(TL_DATUM);
  tft.drawString("backup.tar.gz", 14, y+4, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.setTextDatum(TR_DATUM);
  tft.drawString("124MB", 306, y+5, 1);

  // Bottom stats - Total files & bandwidth
  tft.setTextColor(COLOR_HOT_PINK); tft.setTextDatum(TC_DATUM);
  tft.drawString("45 FILES", 80, 220, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("|", 150, 220, 1);
  tft.setTextColor(COLOR_VIVID_PUR);
  tft.drawString("2.3GB USED", 235, 220, 1);

  drawBackButton();
}

// APIs - MASSIVELY EXTENDED! Response times, status codes, error rates! (BETTER THAN iPHONE!)
void drawAPIs() {
  tft.fillScreen(COLOR_BLACK);
  drawStatusBar();

  // Title
  tft.setTextColor(COLOR_DEEP_MAG);
  tft.setTextDatum(TC_DATUM);
  tft.drawString("APIs", 160, 27, 2);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("REST + GraphQL", 160, 42, 1);

  // API Stats header
  int y = 56;
  tft.setTextDatum(TL_DATUM);
  tft.setTextColor(COLOR_SUNRISE);
  tft.drawString("Total:", 10, y, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("382 req/min | 99.8% uptime", 50, y, 1);

  // 7 Endpoints with detailed stats (compact!)
  y += 16;

  // Endpoint 1: /v1/chat (AI inference)
  tft.fillRoundRect(10, y, 300, 18, 4, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_VIVID_PUR); tft.setTextDatum(TL_DATUM);
  tft.drawString("/v1/chat", 14, y+4, 2);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("247", 100, y+5, 1);
  tft.setTextColor(COLOR_SUNRISE);
  tft.drawString("45ms", 140, y+5, 1);
  tft.setTextColor(COLOR_CYBER_BLUE);
  tft.drawString("200", 185, y+5, 1);
  tft.fillCircle(302, y+9, 3, COLOR_VIVID_PUR); // Status: OK

  // Endpoint 2: /auth/login (Identity)
  y += 22;
  tft.fillRoundRect(10, y, 300, 18, 4, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_CYBER_BLUE); tft.setTextDatum(TL_DATUM);
  tft.drawString("/auth/login", 14, y+4, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("89", 100, y+5, 1);
  tft.setTextColor(COLOR_SUNRISE);
  tft.drawString("12ms", 140, y+5, 1);
  tft.setTextColor(COLOR_CYBER_BLUE);
  tft.drawString("201", 185, y+5, 1);
  tft.fillCircle(302, y+9, 3, COLOR_CYBER_BLUE);

  // Endpoint 3: /crm/leads (CRM)
  y += 22;
  tft.fillRoundRect(10, y, 300, 18, 4, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_MAGENTA); tft.setTextDatum(TL_DATUM);
  tft.drawString("/crm/leads", 14, y+4, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("34", 100, y+5, 1);
  tft.setTextColor(COLOR_SUNRISE);
  tft.drawString("78ms", 140, y+5, 1);
  tft.setTextColor(COLOR_CYBER_BLUE);
  tft.drawString("200", 185, y+5, 1);
  tft.fillCircle(302, y+9, 3, COLOR_MAGENTA);

  // Endpoint 4: /mesh/status (VPN)
  y += 22;
  tft.fillRoundRect(10, y, 300, 18, 4, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_WARM); tft.setTextDatum(TL_DATUM);
  tft.drawString("/mesh/status", 14, y+4, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("12", 100, y+5, 1);
  tft.setTextColor(COLOR_SUNRISE);
  tft.drawString("23ms", 140, y+5, 1);
  tft.setTextColor(COLOR_CYBER_BLUE);
  tft.drawString("200", 185, y+5, 1);
  tft.fillCircle(302, y+9, 3, COLOR_WARM);

  // Endpoint 5: /graphql (GraphQL)
  y += 22;
  tft.fillRoundRect(10, y, 300, 18, 4, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_HOT_PINK); tft.setTextDatum(TL_DATUM);
  tft.drawString("/graphql", 14, y+4, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("156", 100, y+5, 1);
  tft.setTextColor(COLOR_SUNRISE);
  tft.drawString("89ms", 140, y+5, 1);
  tft.setTextColor(COLOR_CYBER_BLUE);
  tft.drawString("200", 185, y+5, 1);
  tft.fillCircle(302, y+9, 3, COLOR_HOT_PINK);

  // Endpoint 6: /files/upload (File storage)
  y += 22;
  tft.fillRoundRect(10, y, 300, 18, 4, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_SUNRISE); tft.setTextDatum(TL_DATUM);
  tft.drawString("/files/upload", 14, y+4, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("8", 100, y+5, 1);
  tft.setTextColor(COLOR_SUNRISE);
  tft.drawString("234ms", 140, y+5, 1);
  tft.setTextColor(COLOR_CYBER_BLUE);
  tft.drawString("201", 185, y+5, 1);
  tft.fillCircle(302, y+9, 3, COLOR_SUNRISE);

  // Endpoint 7: /metrics (Observability)
  y += 22;
  tft.fillRoundRect(10, y, 300, 18, 4, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_VIVID_PUR); tft.setTextDatum(TL_DATUM);
  tft.drawString("/metrics", 14, y+4, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("5", 100, y+5, 1);
  tft.setTextColor(COLOR_SUNRISE);
  tft.drawString("8ms", 140, y+5, 1);
  tft.setTextColor(COLOR_CYBER_BLUE);
  tft.drawString("200", 185, y+5, 1);
  tft.fillCircle(302, y+9, 3, COLOR_VIVID_PUR);

  // Bottom stats - Error rate & rate limiting
  tft.setTextColor(COLOR_HOT_PINK); tft.setTextDatum(TC_DATUM);
  tft.drawString("0.2% ERR", 70, 220, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("|", 130, 220, 1);
  tft.setTextColor(COLOR_VIVID_PUR);
  tft.drawString("1K/min LIMIT", 230, 220, 1);

  drawBackButton();
}

// MESSAGES - MASSIVELY EXTENDED! Threaded conversations, message types, stats! (BETTER THAN iPHONE!)
void drawMessagesScreen() {
  tft.fillScreen(COLOR_BLACK);
  drawStatusBar();

  // Title
  tft.setTextColor(COLOR_HOT_PINK);
  tft.setTextDatum(TC_DATUM);
  tft.drawString("MESSAGES", 160, 27, 2);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("Matrix + Slack Bridge", 160, 42, 1);

  // Stats header
  int y = 56;
  tft.setTextDatum(TL_DATUM);
  tft.setTextColor(COLOR_SUNRISE);
  tft.drawString("Today:", 10, y, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("24 msgs | 3 unread | 8 threads", 50, y, 1);

  // 8 Messages with types: ALERT/UPDATE/CHAT (compact!)
  y += 16;

  // Msg 1: ALERT - UNREAD (lucidia deployment)
  tft.fillRoundRect(10, y, 300, 18, 4, COLOR_DARK_GRAY);
  tft.fillCircle(16, y+9, 3, COLOR_VIVID_PUR); // Unread dot
  tft.setTextColor(COLOR_VIVID_PUR); tft.setTextDatum(TL_DATUM);
  tft.drawString("lucidia", 24, y+4, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("Deploy complete! ðŸš€", 85, y+5, 1);
  tft.setTextColor(COLOR_SUNRISE);
  tft.setTextDatum(TR_DATUM);
  tft.drawString("now", 306, y+5, 1);

  // Msg 2: ALERT - UNREAD (aria PR review)
  y += 22;
  tft.fillRoundRect(10, y, 300, 18, 4, COLOR_DARK_GRAY);
  tft.fillCircle(16, y+9, 3, COLOR_HOT_PINK);
  tft.setTextColor(COLOR_HOT_PINK); tft.setTextDatum(TL_DATUM);
  tft.drawString("aria", 24, y+4, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("PR #847 needs review", 85, y+5, 1);
  tft.setTextColor(COLOR_SUNRISE);
  tft.setTextDatum(TR_DATUM);
  tft.drawString("2m", 306, y+5, 1);

  // Msg 3: ALERT - UNREAD (octavia security)
  y += 22;
  tft.fillRoundRect(10, y, 300, 18, 4, COLOR_DARK_GRAY);
  tft.fillCircle(16, y+9, 3, COLOR_MAGENTA);
  tft.setTextColor(COLOR_MAGENTA); tft.setTextDatum(TL_DATUM);
  tft.drawString("octavia", 24, y+4, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("VPN: latency spike 45ms", 85, y+5, 1);
  tft.setTextColor(COLOR_SUNRISE);
  tft.setTextDatum(TR_DATUM);
  tft.drawString("5m", 306, y+5, 1);

  // Msg 4: UPDATE - Read (shellfish SSH)
  y += 22;
  tft.fillRoundRect(10, y, 300, 18, 4, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_CYBER_BLUE); tft.setTextDatum(TL_DATUM);
  tft.drawString("[ssh]", 14, y+4, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("shellfish: stable 4 nodes", 85, y+5, 1);
  tft.setTextColor(COLOR_SUNRISE);
  tft.setTextDatum(TR_DATUM);
  tft.drawString("12m", 306, y+5, 1);

  // Msg 5: UPDATE - Read (alice APIs)
  y += 22;
  tft.fillRoundRect(10, y, 300, 18, 4, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_WARM); tft.setTextDatum(TL_DATUM);
  tft.drawString("[api]", 14, y+4, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("/chat: 247 req, 45ms avg", 85, y+5, 1);
  tft.setTextColor(COLOR_SUNRISE);
  tft.setTextDatum(TR_DATUM);
  tft.drawString("1h", 306, y+5, 1);

  // Msg 6: CHAT - Read (ai-bot inference)
  y += 22;
  tft.fillRoundRect(10, y, 300, 18, 4, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_VIVID_PUR); tft.setTextDatum(TL_DATUM);
  tft.drawString("ai-bot", 14, y+4, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("Model: Qwen2.5-7B done", 85, y+5, 1);
  tft.setTextColor(COLOR_SUNRISE);
  tft.setTextDatum(TR_DATUM);
  tft.drawString("2h", 306, y+5, 1);

  // Msg 7: UPDATE - Read (security scan)
  y += 22;
  tft.fillRoundRect(10, y, 300, 18, 4, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_CYBER_BLUE); tft.setTextDatum(TL_DATUM);
  tft.drawString("[sec]", 14, y+4, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("Scan: no threats (234 files)", 85, y+5, 1);
  tft.setTextColor(COLOR_SUNRISE);
  tft.setTextDatum(TR_DATUM);
  tft.drawString("4h", 306, y+5, 1);

  // Bottom stats - Message breakdown
  tft.setTextColor(COLOR_HOT_PINK); tft.setTextDatum(TC_DATUM);
  tft.drawString("3 UNREAD", 70, 220, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("|", 135, 220, 1);
  tft.setTextColor(COLOR_VIVID_PUR);
  tft.drawString("8 THREADS", 230, 220, 1);

  drawBackButton();
}

// Old generic iPhone screens removed - replaced with BlackRoad OS proprietary apps

void drawControlCenter() {
  tft.fillScreen(COLOR_BLACK);
  drawStatusBar();

  // Title
  tft.setTextColor(COLOR_WHITE);
  tft.setTextDatum(TC_DATUM);
  tft.drawString("CONTROL CENTER", 160, 30, 2);

  // Quick toggles (2x2 grid)
  // WiFi
  tft.fillRoundRect(10, 55, 70, 60, 10, WiFi.status() == WL_CONNECTED ? COLOR_CYBER_BLUE : COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_WHITE);
  tft.setTextDatum(MC_DATUM);
  tft.drawString("WiFi", 45, 85, 2);

  // Bluetooth
  tft.fillRoundRect(90, 55, 70, 60, 10, COLOR_DARK_GRAY);
  tft.drawString("BT", 125, 85, 2);

  // Airplane
  tft.fillRoundRect(170, 55, 70, 60, 10, COLOR_DARK_GRAY);
  tft.drawString("Plane", 205, 85, 2);

  // Do Not Disturb
  tft.fillRoundRect(250, 55, 70, 60, 10, COLOR_DARK_GRAY);
  tft.drawString("DND", 285, 85, 2);

  // Brightness slider
  tft.setTextColor(COLOR_SUNRISE);
  tft.setTextDatum(TL_DATUM);
  tft.drawString("Brightness", 15, 130, 2);
  tft.fillRoundRect(15, 150, 290, 15, 5, COLOR_DARK_GRAY);
  tft.fillRoundRect(15, 150, 218, 15, 5, COLOR_SUNRISE); // 75% bright

  // Volume slider
  tft.setTextColor(COLOR_VIVID_PUR);
  tft.drawString("Volume", 15, 180, 2);
  tft.fillRoundRect(15, 200, 290, 15, 5, COLOR_DARK_GRAY);
  tft.fillRoundRect(15, 200, 145, 15, 5, COLOR_VIVID_PUR); // 50% volume

  drawBackButton();
}

// WORKFLOW - MASSIVELY EXTENDED! CI/CD pipelines, automation, deployment stats! (BETTER THAN iPHONE!)
void drawWorkflow() {
  tft.fillScreen(COLOR_BLACK);
  drawStatusBar();

  // Title
  tft.setTextColor(COLOR_CYBER_BLUE);
  tft.setTextDatum(TC_DATUM);
  tft.drawString("WORKFLOW", 160, 27, 2);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("Woodpecker CI + Automation", 160, 42, 1);

  // CI/CD Stats header
  int y = 56;
  tft.setTextDatum(TL_DATUM);
  tft.setTextColor(COLOR_SUNRISE);
  tft.drawString("Today:", 10, y, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("47 runs | 42âœ… 5âŒ | 89% pass", 50, y, 1);

  // 7 Active Pipelines/Workflows (compact!)
  y += 16;

  // Pipeline 1: RUNNING (main branch CI)
  tft.fillRoundRect(10, y, 300, 18, 4, COLOR_DARK_GRAY);
  tft.fillCircle(16, y+9, 3, COLOR_CYBER_BLUE); // Running
  tft.setTextColor(COLOR_CYBER_BLUE); tft.setTextDatum(TL_DATUM);
  tft.drawString("[CI]", 24, y+4, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("main: tests+build", 60, y+5, 1);
  tft.setTextColor(COLOR_SUNRISE);
  tft.setTextDatum(TR_DATUM);
  tft.drawString("2m 34s", 306, y+5, 1);

  // Pipeline 2: SUCCESS (deploy production)
  y += 22;
  tft.fillRoundRect(10, y, 300, 18, 4, COLOR_DARK_GRAY);
  tft.fillCircle(16, y+9, 3, COLOR_VIVID_PUR); // Success
  tft.setTextColor(COLOR_VIVID_PUR); tft.setTextDatum(TL_DATUM);
  tft.drawString("[DEPLOY]", 24, y+4, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("prod: v1.9.0", 85, y+5, 1);
  tft.setTextColor(COLOR_SUNRISE);
  tft.setTextDatum(TR_DATUM);
  tft.drawString("4m ago", 306, y+5, 1);

  // Pipeline 3: FAILED (test suite)
  y += 22;
  tft.fillRoundRect(10, y, 300, 18, 4, COLOR_DARK_GRAY);
  tft.fillCircle(16, y+9, 3, COLOR_HOT_PINK); // Failed
  tft.setTextColor(COLOR_HOT_PINK); tft.setTextDatum(TL_DATUM);
  tft.drawString("[TEST]", 24, y+4, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("PR #847: 3/42 fail", 85, y+5, 1);
  tft.setTextColor(COLOR_SUNRISE);
  tft.setTextDatum(TR_DATUM);
  tft.drawString("12m ago", 306, y+5, 1);

  // Pipeline 4: QUEUED (staging deploy)
  y += 22;
  tft.fillRoundRect(10, y, 300, 18, 4, COLOR_DARK_GRAY);
  tft.fillCircle(16, y+9, 3, COLOR_SUNRISE); // Queued
  tft.setTextColor(COLOR_SUNRISE); tft.setTextDatum(TL_DATUM);
  tft.drawString("[STAGE]", 24, y+4, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("staging: waiting...", 85, y+5, 1);
  tft.setTextColor(COLOR_SUNRISE);
  tft.setTextDatum(TR_DATUM);
  tft.drawString("queued", 306, y+5, 1);

  // Pipeline 5: SUCCESS (docker build)
  y += 22;
  tft.fillRoundRect(10, y, 300, 18, 4, COLOR_DARK_GRAY);
  tft.fillCircle(16, y+9, 3, COLOR_VIVID_PUR);
  tft.setTextColor(COLOR_MAGENTA); tft.setTextDatum(TL_DATUM);
  tft.drawString("[BUILD]", 24, y+4, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("docker: api-server", 85, y+5, 1);
  tft.setTextColor(COLOR_SUNRISE);
  tft.setTextDatum(TR_DATUM);
  tft.drawString("1h ago", 306, y+5, 1);

  // Pipeline 6: SUCCESS (backup automation)
  y += 22;
  tft.fillRoundRect(10, y, 300, 18, 4, COLOR_DARK_GRAY);
  tft.fillCircle(16, y+9, 3, COLOR_VIVID_PUR);
  tft.setTextColor(COLOR_WARM); tft.setTextDatum(TL_DATUM);
  tft.drawString("[CRON]", 24, y+4, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("backup: 2.3GBâ†’S3", 85, y+5, 1);
  tft.setTextColor(COLOR_SUNRISE);
  tft.setTextDatum(TR_DATUM);
  tft.drawString("2h ago", 306, y+5, 1);

  // Bottom stats - Automation metrics
  tft.setTextColor(COLOR_HOT_PINK); tft.setTextDatum(TC_DATUM);
  tft.drawString("7 ACTIVE", 70, 220, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("|", 130, 220, 1);
  tft.setTextColor(COLOR_VIVID_PUR);
  tft.drawString("89% PASS RATE", 235, 220, 1);

  drawBackButton();
}

// TERMINAL - SSH command history + live output (BETTER THAN iPHONE!)
void drawTerminal() {
  tft.fillScreen(COLOR_BLACK);
  drawStatusBar();

  // Title
  tft.setTextColor(COLOR_CYBER_BLUE);
  tft.setTextDatum(TC_DATUM);
  tft.drawString("TERMINAL", 160, 27, 2);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("SSH Sessions + Command History", 160, 42, 1);

  // SSH Connection Status header
  int y = 56;
  tft.setTextDatum(TL_DATUM);
  tft.setTextColor(COLOR_SUNRISE);
  tft.drawString("Connected:", 10, y, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("4 nodes | 192.168.4.x mesh", 75, y, 1);

  // Active SSH sessions (enhanced badges with shadows!)
  y += 14;
  drawStatusBadge(10, y, "lucidia", true, COLOR_CYBER_BLUE);
  drawStatusBadge(85, y, "octavia", true, COLOR_CYBER_BLUE);
  drawStatusBadge(160, y, "alice", true, COLOR_CYBER_BLUE);
  drawStatusBadge(235, y, "shellfish", false, COLOR_SUNRISE); // Connecting

  // Command history (last 8 lines - alternating $ commands and > output)
  y += 20;
  tft.setTextDatum(TL_DATUM);
  tft.setTextColor(COLOR_SUNRISE);
  tft.drawString("History:", 10, y, 1);

  y += 14;
  for (int i = 0; i < historyCount && i < 8; i++) {
    String line = terminalHistory[i];
    if (line.startsWith("$")) {
      // Command line (cyan)
      tft.setTextColor(COLOR_CYBER_BLUE);
    } else if (line.startsWith(">")) {
      // Output line (white)
      tft.setTextColor(COLOR_WHITE);
    } else {
      // Error or other (pink)
      tft.setTextColor(COLOR_HOT_PINK);
    }

    // Truncate if too long
    if (line.length() > 50) {
      line = line.substring(0, 47) + "...";
    }

    tft.drawString(line, 10, y, 1);
    y += 11; // Compact spacing
  }

  // Current command input area (with cursor)
  y += 8;
  tft.fillRoundRect(10, y, 300, 20, 4, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_CYBER_BLUE); tft.setTextDatum(TL_DATUM);
  tft.drawString("$ ", 14, y+6, 1);
  tft.setTextColor(COLOR_WHITE);
  String displayBuffer = terminalBuffer;
  if (displayBuffer.length() > 42) {
    displayBuffer = displayBuffer.substring(displayBuffer.length() - 42);
  }
  tft.drawString(displayBuffer, 26, y+6, 1);

  // Blinking cursor
  if ((millis() / 500) % 2 == 0) {
    int cursorX = 26 + (displayBuffer.length() * 6);
    tft.fillRect(cursorX, y+6, 6, 10, COLOR_CYBER_BLUE);
  }

  // Bottom controls - Keyboard button
  tft.setTextColor(COLOR_HOT_PINK); tft.setTextDatum(TC_DATUM);
  tft.drawString("TAP KEYBOARD", 90, 220, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("|", 160, 220, 1);
  tft.setTextColor(COLOR_VIVID_PUR);
  tft.drawString("ENTER=RUN", 235, 220, 1);

  // Keyboard button (enhanced with shadow!)
  drawButton(198, 213, 110, 22, "âŒ¨ KEYBOARD", COLOR_CYBER_BLUE);

  drawBackButton();
}

// KEYBOARD - Pop-up QWERTY overlay (BETTER THAN iPHONE!)
void drawKeyboard() {
  // Semi-transparent overlay (redraw previous screen dimmed)
  tft.fillRect(0, 90, 320, 150, COLOR_DARK_GRAY);

  // Keyboard background
  tft.fillRoundRect(5, 95, 310, 140, 8, COLOR_BLACK);
  tft.drawRoundRect(5, 95, 310, 140, 8, COLOR_CYBER_BLUE);

  // Title bar
  tft.fillRoundRect(10, 100, 300, 18, 4, COLOR_CYBER_BLUE);
  tft.setTextColor(COLOR_BLACK); tft.setTextDatum(TC_DATUM);
  tft.drawString("KEYBOARD", 160, 104, 2);

  // QWERTY layout - 3 rows + bottom controls (compact for 320x240)
  const char* row1 = "QWERTYUIOP";
  const char* row2 = "ASDFGHJKL";
  const char* row3 = "ZXCVBNM";

  int keyWidth = 28;
  int keyHeight = 24;
  int keySpacing = 2;

  // Row 1 (10 keys)
  int y = 123;
  int startX = 10;
  for (int i = 0; i < 10; i++) {
    int x = startX + i * (keyWidth + keySpacing);
    tft.fillRoundRect(x, y, keyWidth, keyHeight, 3, COLOR_DARK_GRAY);
    tft.setTextColor(COLOR_WHITE); tft.setTextDatum(MC_DATUM);
    char key[2] = {row1[i], '\0'};
    tft.drawString(key, x + keyWidth/2, y + keyHeight/2, 2);
  }

  // Row 2 (9 keys - centered)
  y += keyHeight + keySpacing + 2;
  startX = 25; // Offset for centering
  for (int i = 0; i < 9; i++) {
    int x = startX + i * (keyWidth + keySpacing);
    tft.fillRoundRect(x, y, keyWidth, keyHeight, 3, COLOR_DARK_GRAY);
    tft.setTextColor(COLOR_WHITE); tft.setTextDatum(MC_DATUM);
    char key[2] = {row2[i], '\0'};
    tft.drawString(key, x + keyWidth/2, y + keyHeight/2, 2);
  }

  // Row 3 (7 keys - centered)
  y += keyHeight + keySpacing + 2;
  startX = 55; // More offset for centering
  for (int i = 0; i < 7; i++) {
    int x = startX + i * (keyWidth + keySpacing);
    tft.fillRoundRect(x, y, keyWidth, keyHeight, 3, COLOR_DARK_GRAY);
    tft.setTextColor(COLOR_WHITE); tft.setTextDatum(MC_DATUM);
    char key[2] = {row3[i], '\0'};
    tft.drawString(key, x + keyWidth/2, y + keyHeight/2, 2);
  }

  // Bottom row: Enhanced buttons with shadows!
  y += keyHeight + keySpacing + 3;

  // SPACE (wide, enhanced)
  drawButton(10, y, 100, keyHeight, "SPACE", COLOR_DARK_GRAY);

  // BACKSPACE (enhanced)
  drawButton(115, y, 60, keyHeight, "< DEL", COLOR_HOT_PINK);

  // ENTER (enhanced)
  drawButton(180, y, 50, keyHeight, "ENTER", COLOR_VIVID_PUR);

  // DONE (close keyboard, enhanced)
  drawButton(235, y, 75, keyHeight, "DONE", COLOR_SUNRISE);
}

void drawDecisions() {
  tft.fillScreen(COLOR_BLACK);
  drawStatusBar();

  // Title
  tft.setTextColor(COLOR_HOT_PINK);
  tft.setTextDatum(TC_DATUM);
  tft.drawString("DECISIONS (T1)", 160, 28, 2);

  // Decision Card 1: Vendor Contract
  int y = 52;
  tft.fillRoundRect(10, y, 300, 50, 8, COLOR_DARK_GRAY);

  // Title with BRAIN emoji indicator
  tft.setTextColor(COLOR_MAGENTA);
  tft.setTextDatum(TL_DATUM);
  tft.drawString("BRAIN", 15, y+5, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("Vendor contract renewal", 50, y+5, 2);

  // Priority + Owner
  tft.fillCircle(18, y+28, 5, COLOR_HOT_PINK); // Critical
  tft.fillCircle(20, y+28, 7, COLOR_HOT_PINK);
  tft.setTextColor(COLOR_VIVID_PUR);
  tft.drawString("EXEC", 30, y+24, 1);
  tft.setTextColor(COLOR_SUNRISE);
  tft.drawString("VOICE", 70, y+24, 1);

  // Action buttons
  tft.fillRoundRect(15, y+36, 85, 10, 3, COLOR_VIVID_PUR);
  tft.setTextColor(COLOR_WHITE);
  tft.setTextDatum(TC_DATUM);
  tft.drawString("APPROVE", 57, y+37, 1);

  tft.fillRoundRect(108, y+36, 85, 10, 3, COLOR_HOT_PINK);
  tft.drawString("REJECT", 150, y+37, 1);

  tft.fillRoundRect(201, y+36, 100, 10, 3, COLOR_SUNRISE);
  tft.drawString("HOLD", 251, y+37, 1);

  y += 58;

  // Decision Card 2: Pricing Approval
  tft.fillRoundRect(10, y, 300, 50, 8, COLOR_DARK_GRAY);

  tft.setTextColor(COLOR_MAGENTA);
  tft.setTextDatum(TL_DATUM);
  tft.drawString("BRAIN", 15, y+5, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("Q4 pricing approval", 50, y+5, 2);

  tft.fillCircle(18, y+28, 5, COLOR_HOT_PINK); // High
  tft.setTextColor(COLOR_CYBER_BLUE);
  tft.drawString("TEAM", 30, y+24, 1);
  tft.setTextColor(COLOR_SUNRISE);
  tft.drawString("DOC", 70, y+24, 1);

  tft.fillRoundRect(15, y+36, 85, 10, 3, COLOR_VIVID_PUR);
  tft.setTextColor(COLOR_WHITE);
  tft.setTextDatum(TC_DATUM);
  tft.drawString("APPROVE", 57, y+37, 1);

  tft.fillRoundRect(108, y+36, 85, 10, 3, COLOR_HOT_PINK);
  tft.drawString("REJECT", 150, y+37, 1);

  tft.fillRoundRect(201, y+36, 100, 10, 3, COLOR_SUNRISE);
  tft.drawString("HOLD", 251, y+37, 1);

  y += 58;

  // Decision Card 3: Partnership Deal
  tft.fillRoundRect(10, y, 300, 50, 8, COLOR_DARK_GRAY);

  tft.setTextColor(COLOR_MAGENTA);
  tft.setTextDatum(TL_DATUM);
  tft.drawString("BRAIN", 15, y+5, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("Partnership deal terms", 50, y+5, 2);

  tft.fillCircle(18, y+28, 5, COLOR_SUNRISE); // Medium
  tft.setTextColor(COLOR_WARM);
  tft.drawString("OPS", 30, y+24, 1);
  tft.setTextColor(COLOR_SUNRISE);
  tft.drawString("BRIEF", 60, y+24, 1);

  tft.fillRoundRect(15, y+36, 85, 10, 3, COLOR_VIVID_PUR);
  tft.setTextColor(COLOR_WHITE);
  tft.setTextDatum(TC_DATUM);
  tft.drawString("APPROVE", 57, y+37, 1);

  tft.fillRoundRect(108, y+36, 85, 10, 3, COLOR_HOT_PINK);
  tft.drawString("REJECT", 150, y+37, 1);

  tft.fillRoundRect(201, y+36, 100, 10, 3, COLOR_SUNRISE);
  tft.drawString("HOLD", 251, y+37, 1);

  // Stats
  tft.setTextColor(COLOR_WHITE);
  tft.setTextDatum(TC_DATUM);
  tft.drawString("3 Pending  |  Voice-First", 160, 215, 1);

  drawBackButton();
}

void drawCEODashboard() {
  tft.fillScreen(COLOR_BLACK);
  drawStatusBar();

  // Title
  tft.setTextColor(COLOR_CYBER_BLUE);
  tft.setTextDatum(TC_DATUM);
  tft.drawString("CEO DASH (T2)", 160, 28, 2);

  // Dashboard = emoji filters (live query)
  int y = 52;

  // CRITICAL + BRAIN (decisions pending)
  tft.fillRoundRect(10, y, 300, 24, 5, COLOR_DARK_GRAY);
  tft.fillCircle(18, y+12, 5, COLOR_HOT_PINK);
  tft.fillCircle(20, y+12, 7, COLOR_HOT_PINK);
  tft.setTextColor(COLOR_MAGENTA);
  tft.setTextDatum(TL_DATUM);
  tft.drawString("BRAIN", 30, y+4, 2);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("Decisions pending", 90, y+4, 2);
  tft.setTextColor(COLOR_HOT_PINK);
  tft.setTextDatum(TR_DATUM);
  tft.drawString("3", 305, y+4, 2);

  y += 28;

  // BLOCKED items
  tft.fillRoundRect(10, y, 300, 24, 5, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_HOT_PINK);
  tft.setTextDatum(TL_DATUM);
  tft.drawString("BLOCKED", 15, y+4, 2);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("Blocked items", 100, y+4, 2);
  tft.setTextColor(COLOR_HOT_PINK);
  tft.setTextDatum(TR_DATUM);
  tft.drawString("2", 305, y+4, 2);

  y += 28;

  // TIME-SENSITIVE
  tft.fillRoundRect(10, y, 300, 24, 5, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_SUNRISE);
  tft.setTextDatum(TL_DATUM);
  tft.drawString("TIME", 15, y+4, 2);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("Time-sensitive", 70, y+4, 2);
  tft.setTextColor(COLOR_SUNRISE);
  tft.setTextDatum(TR_DATUM);
  tft.drawString("5", 305, y+4, 2);

  y += 28;

  // SHIPPED (7d)
  tft.fillRoundRect(10, y, 300, 24, 5, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_VIVID_PUR);
  tft.setTextDatum(TL_DATUM);
  tft.drawString("SHIP", 15, y+4, 2);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("Shipped (7d)", 70, y+4, 2);
  tft.setTextColor(COLOR_VIVID_PUR);
  tft.setTextDatum(TR_DATUM);
  tft.drawString("11", 305, y+4, 2);

  y += 28;

  // ESCALATIONS
  tft.fillRoundRect(10, y, 300, 24, 5, COLOR_DARK_GRAY);
  tft.setTextColor(COLOR_HOT_PINK);
  tft.setTextDatum(TL_DATUM);
  tft.drawString("ESCALATE", 15, y+4, 2);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("Escalations", 105, y+4, 2);
  tft.setTextColor(COLOR_HOT_PINK);
  tft.setTextDatum(TR_DATUM);
  tft.drawString("1", 305, y+4, 2);

  y += 32;

  // Voice summary indicator
  tft.setTextColor(COLOR_SUNRISE);
  tft.setTextDatum(TC_DATUM);
  tft.drawString("VOICE", 50, y, 2);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("Tap to hear summary", 200, y, 1);

  // Stats footer
  tft.setTextDatum(TC_DATUM);
  tft.drawString("Live Query  |  Tap = Expand", 160, 215, 1);

  drawBackButton();
}

void drawCEOCore() {
  tft.fillScreen(COLOR_BLACK);
  drawStatusBar();

  // Title
  tft.setTextColor(COLOR_HOT_PINK);
  tft.setTextDatum(TC_DATUM);
  tft.drawString("CEO CORE 3x3", 160, 28, 2);

  // 3Ã—3 Grid (80Ã—80 buttons, centered)
  int startX = 40;
  int startY = 50;
  int btnSize = 80;
  int gap = 0;

  // ROW 1: REJECT | HOLD | APPROVE (with 3D shadows!)
  // Button: REJECT (âŒ) - Shadow + 3D
  tft.fillRoundRect(startX+3, startY+3, btnSize, btnSize, 8, 0x18E3); // Shadow
  tft.fillRoundRect(startX, startY, btnSize, btnSize, 8, COLOR_HOT_PINK);
  tft.drawFastHLine(startX+8, startY+2, btnSize-16, 0xFBEA); // Top highlight
  tft.setTextColor(COLOR_WHITE);
  tft.setTextDatum(MC_DATUM);
  tft.drawString("X", startX+btnSize/2, startY+btnSize/2-10, 4);
  tft.drawString("REJECT", startX+btnSize/2, startY+btnSize/2+15, 1);

  // Button: HOLD (ðŸ’­) - Shadow + 3D
  tft.fillRoundRect(startX+btnSize+gap+3, startY+3, btnSize, btnSize, 8, 0x18E3);
  tft.fillRoundRect(startX+btnSize+gap, startY, btnSize, btnSize, 8, COLOR_SUNRISE);
  tft.drawFastHLine(startX+btnSize+gap+8, startY+2, btnSize-16, 0xFBEA);
  tft.drawString("...", startX+btnSize+gap+btnSize/2, startY+btnSize/2-10, 4);
  tft.drawString("HOLD", startX+btnSize+gap+btnSize/2, startY+btnSize/2+15, 1);

  // Button: APPROVE (âœ…) - Shadow + 3D
  tft.fillRoundRect(startX+(btnSize+gap)*2+3, startY+3, btnSize, btnSize, 8, 0x18E3);
  tft.fillRoundRect(startX+(btnSize+gap)*2, startY, btnSize, btnSize, 8, COLOR_VIVID_PUR);
  tft.drawFastHLine(startX+(btnSize+gap)*2+8, startY+2, btnSize-16, 0xFBEA);
  tft.drawString("\\/", startX+(btnSize+gap)*2+btnSize/2, startY+btnSize/2-10, 4);
  tft.drawString("APPROVE", startX+(btnSize+gap)*2+btnSize/2, startY+btnSize/2+15, 1);

  // ROW 2: BLOCKED | BRAIN | NEXT (with 3D shadows!)
  int y2 = startY + btnSize + gap;

  // Button: BLOCKED (ðŸ§±) - Shadow + 3D
  tft.fillRoundRect(startX+3, y2+3, btnSize, btnSize, 8, 0x18E3); // Shadow
  tft.fillRoundRect(startX, y2, btnSize, btnSize, 8, COLOR_HOT_PINK);
  tft.drawFastHLine(startX+8, y2+2, btnSize-16, 0xFBEA); // Top highlight
  tft.drawString("##", startX+btnSize/2, y2+btnSize/2-10, 4);
  tft.drawString("BLOCKED", startX+btnSize/2, y2+btnSize/2+15, 1);

  // Button: BRAIN (ðŸ§ ) - CENTER - ACTIVE - Shadow + 3D
  tft.fillRoundRect(startX+btnSize+gap+3, y2+3, btnSize, btnSize, 8, 0x18E3); // Shadow
  tft.fillRoundRect(startX+btnSize+gap, y2, btnSize, btnSize, 8, COLOR_MAGENTA);
  tft.drawFastHLine(startX+btnSize+gap+8, y2+2, btnSize-16, 0xFBEA); // Top highlight
  tft.fillCircle(startX+btnSize+gap+btnSize/2, y2+btnSize/2-5, 8, COLOR_HOT_PINK); // Pulse indicator
  tft.drawString("@", startX+btnSize+gap+btnSize/2, y2+btnSize/2-10, 4);
  tft.drawString("BRAIN", startX+btnSize+gap+btnSize/2, y2+btnSize/2+15, 1);

  // Button: NEXT (ðŸ”œ) - Shadow + 3D
  tft.fillRoundRect(startX+(btnSize+gap)*2+3, y2+3, btnSize, btnSize, 8, 0x18E3); // Shadow
  tft.fillRoundRect(startX+(btnSize+gap)*2, y2, btnSize, btnSize, 8, COLOR_CYBER_BLUE);
  tft.drawFastHLine(startX+(btnSize+gap)*2+8, y2+2, btnSize-16, 0xFBEA); // Top highlight
  tft.drawString(">", startX+(btnSize+gap)*2+btnSize/2, y2+btnSize/2-10, 4);
  tft.drawString("NEXT", startX+(btnSize+gap)*2+btnSize/2, y2+btnSize/2+15, 1);

  // ROW 3: CRITICAL | ESCALATE | SHIP (with 3D shadows!)
  int y3 = y2 + btnSize + gap;

  // Button: CRITICAL (ðŸ”¥) - Shadow + 3D
  tft.fillRoundRect(startX+3, y3+3, btnSize, btnSize, 8, 0x18E3); // Shadow
  tft.fillRoundRect(startX, y3, btnSize, btnSize, 8, COLOR_HOT_PINK);
  tft.drawFastHLine(startX+8, y3+2, btnSize-16, 0xFBEA); // Top highlight
  tft.fillCircle(startX+btnSize/2, y3+btnSize/2-5, 5, COLOR_WHITE);
  tft.fillCircle(startX+btnSize/2, y3+btnSize/2-5, 8, COLOR_HOT_PINK);
  tft.drawString("!!", startX+btnSize/2, y3+btnSize/2-10, 4);
  tft.drawString("CRITICAL", startX+btnSize/2, y3+btnSize/2+15, 1);

  // Button: ESCALATE (ðŸªœ) - Shadow + 3D
  tft.fillRoundRect(startX+btnSize+gap+3, y3+3, btnSize, btnSize, 8, 0x18E3); // Shadow
  tft.fillRoundRect(startX+btnSize+gap, y3, btnSize, btnSize, 8, COLOR_WARM);
  tft.drawFastHLine(startX+btnSize+gap+8, y3+2, btnSize-16, 0xFBEA); // Top highlight
  tft.drawString("^^", startX+btnSize+gap+btnSize/2, y3+btnSize/2-10, 4);
  tft.drawString("ESCALATE", startX+btnSize+gap+btnSize/2, y3+btnSize/2+15, 1);

  // Button: SHIP (ðŸš€) - Shadow + 3D
  tft.fillRoundRect(startX+(btnSize+gap)*2+3, y3+3, btnSize, btnSize, 8, 0x18E3); // Shadow
  tft.fillRoundRect(startX+(btnSize+gap)*2, y3, btnSize, btnSize, 8, COLOR_VIVID_PUR);
  tft.drawFastHLine(startX+(btnSize+gap)*2+8, y3+2, btnSize-16, 0xFBEA); // Top highlight
  tft.drawString("^", startX+(btnSize+gap)*2+btnSize/2, y3+btnSize/2-10, 4);
  tft.drawString("SHIP", startX+(btnSize+gap)*2+btnSize/2, y3+btnSize/2+15, 1);

  drawBackButton();
}

void drawExecGrid() {
  tft.fillScreen(COLOR_BLACK);
  drawStatusBar();

  // Title
  tft.setTextColor(COLOR_VIVID_PUR);
  tft.setTextDatum(TC_DATUM);
  tft.drawString("EXEC 4x4", 160, 28, 2);

  // 4Ã—4 Grid (60Ã—60 buttons)
  int startX = 50;
  int startY = 50;
  int btnSize = 60;
  int gap = 2;

  // ROW 1: REJECT | HOLD | BRAIN | APPROVE (with 3D shadows!)
  tft.setTextColor(COLOR_WHITE);
  tft.setTextDatum(MC_DATUM);

  // REJECT - Shadow + 3D
  tft.fillRoundRect(startX+3, startY+3, btnSize, btnSize, 6, 0x18E3);
  tft.fillRoundRect(startX, startY, btnSize, btnSize, 6, COLOR_HOT_PINK);
  tft.drawFastHLine(startX+8, startY+2, btnSize-16, 0xFBEA);
  tft.drawString("X", startX+btnSize/2, startY+btnSize/2-8, 3);
  tft.drawString("REJ", startX+btnSize/2, startY+btnSize/2+12, 1);

  // HOLD - Shadow + 3D
  tft.fillRoundRect(startX+(btnSize+gap)+3, startY+3, btnSize, btnSize, 6, 0x18E3);
  tft.fillRoundRect(startX+(btnSize+gap), startY, btnSize, btnSize, 6, COLOR_SUNRISE);
  tft.drawFastHLine(startX+(btnSize+gap)+8, startY+2, btnSize-16, 0xFBEA);
  tft.drawString("...", startX+(btnSize+gap)+btnSize/2, startY+btnSize/2-8, 3);
  tft.drawString("HOLD", startX+(btnSize+gap)+btnSize/2, startY+btnSize/2+12, 1);

  // BRAIN - Shadow + 3D
  tft.fillRoundRect(startX+(btnSize+gap)*2+3, startY+3, btnSize, btnSize, 6, 0x18E3);
  tft.fillRoundRect(startX+(btnSize+gap)*2, startY, btnSize, btnSize, 6, COLOR_MAGENTA);
  tft.drawFastHLine(startX+(btnSize+gap)*2+8, startY+2, btnSize-16, 0xFBEA);
  tft.drawString("@", startX+(btnSize+gap)*2+btnSize/2, startY+btnSize/2-8, 3);
  tft.drawString("BRAIN", startX+(btnSize+gap)*2+btnSize/2, startY+btnSize/2+12, 1);

  // APPROVE - Shadow + 3D
  tft.fillRoundRect(startX+(btnSize+gap)*3+3, startY+3, btnSize, btnSize, 6, 0x18E3);
  tft.fillRoundRect(startX+(btnSize+gap)*3, startY, btnSize, btnSize, 6, COLOR_VIVID_PUR);
  tft.drawFastHLine(startX+(btnSize+gap)*3+8, startY+2, btnSize-16, 0xFBEA);
  tft.drawString("\\/", startX+(btnSize+gap)*3+btnSize/2, startY+btnSize/2-8, 3);
  tft.drawString("APV", startX+(btnSize+gap)*3+btnSize/2, startY+btnSize/2+12, 1);

  // ROW 2: BLOCKED | RISK | CRITICAL | NEXT (with 3D shadows!)
  int y2 = startY + btnSize + gap;

  // BLOCKED - Shadow + 3D
  tft.fillRoundRect(startX+3, y2+3, btnSize, btnSize, 6, 0x18E3);
  tft.fillRoundRect(startX, y2, btnSize, btnSize, 6, COLOR_HOT_PINK);
  tft.drawFastHLine(startX+8, y2+2, btnSize-16, 0xFBEA);
  tft.drawString("##", startX+btnSize/2, y2+btnSize/2-8, 3);
  tft.drawString("BLOCK", startX+btnSize/2, y2+btnSize/2+12, 1);

  // RISK - Shadow + 3D
  tft.fillRoundRect(startX+(btnSize+gap)+3, y2+3, btnSize, btnSize, 6, 0x18E3);
  tft.fillRoundRect(startX+(btnSize+gap), y2, btnSize, btnSize, 6, COLOR_SUNRISE);
  tft.drawFastHLine(startX+(btnSize+gap)+8, y2+2, btnSize-16, 0xFBEA);
  tft.drawString("/!\\", startX+(btnSize+gap)+btnSize/2, y2+btnSize/2-8, 3);
  tft.drawString("RISK", startX+(btnSize+gap)+btnSize/2, y2+btnSize/2+12, 1);

  // CRITICAL - Shadow + 3D
  tft.fillRoundRect(startX+(btnSize+gap)*2+3, y2+3, btnSize, btnSize, 6, 0x18E3);
  tft.fillRoundRect(startX+(btnSize+gap)*2, y2, btnSize, btnSize, 6, COLOR_HOT_PINK);
  tft.drawFastHLine(startX+(btnSize+gap)*2+8, y2+2, btnSize-16, 0xFBEA);
  tft.fillCircle(startX+(btnSize+gap)*2+btnSize/2, y2+btnSize/2-5, 5, COLOR_WHITE);
  tft.drawString("!!", startX+(btnSize+gap)*2+btnSize/2, y2+btnSize/2-8, 3);
  tft.drawString("CRIT", startX+(btnSize+gap)*2+btnSize/2, y2+btnSize/2+12, 1);

  // NEXT - Shadow + 3D
  tft.fillRoundRect(startX+(btnSize+gap)*3+3, y2+3, btnSize, btnSize, 6, 0x18E3);
  tft.fillRoundRect(startX+(btnSize+gap)*3, y2, btnSize, btnSize, 6, COLOR_CYBER_BLUE);
  tft.drawFastHLine(startX+(btnSize+gap)*3+8, y2+2, btnSize-16, 0xFBEA);
  tft.drawString(">", startX+(btnSize+gap)*3+btnSize/2, y2+btnSize/2-8, 3);
  tft.drawString("NEXT", startX+(btnSize+gap)*3+btnSize/2, y2+btnSize/2+12, 1);

  // ROW 3: USER | TEAM | ESCALATE | DIRECTION (with 3D shadows!)
  int y3 = y2 + btnSize + gap;

  // USER - Shadow + 3D
  tft.fillRoundRect(startX+3, y3+3, btnSize, btnSize, 6, 0x18E3);
  tft.fillRoundRect(startX, y3, btnSize, btnSize, 6, COLOR_VIVID_PUR);
  tft.drawFastHLine(startX+8, y3+2, btnSize-16, 0xFBEA);
  tft.drawString("1", startX+btnSize/2, y3+btnSize/2-8, 3);
  tft.drawString("USER", startX+btnSize/2, y3+btnSize/2+12, 1);

  // TEAM - Shadow + 3D
  tft.fillRoundRect(startX+(btnSize+gap)+3, y3+3, btnSize, btnSize, 6, 0x18E3);
  tft.fillRoundRect(startX+(btnSize+gap), y3, btnSize, btnSize, 6, COLOR_CYBER_BLUE);
  tft.drawFastHLine(startX+(btnSize+gap)+8, y3+2, btnSize-16, 0xFBEA);
  tft.drawString("++", startX+(btnSize+gap)+btnSize/2, y3+btnSize/2-8, 3);
  tft.drawString("TEAM", startX+(btnSize+gap)+btnSize/2, y3+btnSize/2+12, 1);

  // ESCALATE - Shadow + 3D
  tft.fillRoundRect(startX+(btnSize+gap)*2+3, y3+3, btnSize, btnSize, 6, 0x18E3);
  tft.fillRoundRect(startX+(btnSize+gap)*2, y3, btnSize, btnSize, 6, COLOR_WARM);
  tft.drawFastHLine(startX+(btnSize+gap)*2+8, y3+2, btnSize-16, 0xFBEA);
  tft.drawString("^^", startX+(btnSize+gap)*2+btnSize/2, y3+btnSize/2-8, 3);
  tft.drawString("ESC", startX+(btnSize+gap)*2+btnSize/2, y3+btnSize/2+12, 1);

  // DIRECTION - Shadow + 3D
  tft.fillRoundRect(startX+(btnSize+gap)*3+3, y3+3, btnSize, btnSize, 6, 0x18E3);
  tft.fillRoundRect(startX+(btnSize+gap)*3, y3, btnSize, btnSize, 6, COLOR_SUNRISE);
  tft.drawFastHLine(startX+(btnSize+gap)*3+8, y3+2, btnSize-16, 0xFBEA);
  tft.drawString("<>", startX+(btnSize+gap)*3+btnSize/2, y3+btnSize/2-8, 3);
  tft.drawString("DIR", startX+(btnSize+gap)*3+btnSize/2, y3+btnSize/2+12, 1);

  // ROW 4: VOICE | METRICS | RECURRING | SHIP (with 3D shadows!)
  int y4 = y3 + btnSize + gap;

  // VOICE - Shadow + 3D
  tft.fillRoundRect(startX+3, y4+3, btnSize, btnSize, 6, 0x18E3);
  tft.fillRoundRect(startX, y4, btnSize, btnSize, 6, COLOR_SUNRISE);
  tft.drawFastHLine(startX+8, y4+2, btnSize-16, 0xFBEA);
  tft.drawString("o", startX+btnSize/2, y4+btnSize/2-8, 3);
  tft.drawString("VOICE", startX+btnSize/2, y4+btnSize/2+12, 1);

  // METRICS (DATA) - Shadow + 3D
  tft.fillRoundRect(startX+(btnSize+gap)+3, y4+3, btnSize, btnSize, 6, 0x18E3);
  tft.fillRoundRect(startX+(btnSize+gap), y4, btnSize, btnSize, 6, COLOR_CYBER_BLUE);
  tft.drawFastHLine(startX+(btnSize+gap)+8, y4+2, btnSize-16, 0xFBEA);
  tft.drawString("|_|", startX+(btnSize+gap)+btnSize/2, y4+btnSize/2-8, 3);
  tft.drawString("DATA", startX+(btnSize+gap)+btnSize/2, y4+btnSize/2+12, 1);

  // RECURRING (LOOP) - Shadow + 3D
  tft.fillRoundRect(startX+(btnSize+gap)*2+3, y4+3, btnSize, btnSize, 6, 0x18E3);
  tft.fillRoundRect(startX+(btnSize+gap)*2, y4, btnSize, btnSize, 6, COLOR_MAGENTA);
  tft.drawFastHLine(startX+(btnSize+gap)*2+8, y4+2, btnSize-16, 0xFBEA);
  tft.drawString("oo", startX+(btnSize+gap)*2+btnSize/2, y4+btnSize/2-8, 3);
  tft.drawString("LOOP", startX+(btnSize+gap)*2+btnSize/2, y4+btnSize/2+12, 1);

  // SHIP - Shadow + 3D
  tft.fillRoundRect(startX+(btnSize+gap)*3+3, y4+3, btnSize, btnSize, 6, 0x18E3);
  tft.fillRoundRect(startX+(btnSize+gap)*3, y4, btnSize, btnSize, 6, COLOR_VIVID_PUR);
  tft.drawFastHLine(startX+(btnSize+gap)*3+8, y4+2, btnSize-16, 0xFBEA);
  tft.drawString("^", startX+(btnSize+gap)*3+btnSize/2, y4+btnSize/2-8, 3);
  tft.drawString("SHIP", startX+(btnSize+gap)*3+btnSize/2, y4+btnSize/2+12, 1);

  drawBackButton();
}

// META - ULTIMATE RECURSION! Aggregates ALL app data! (NO iPHONE CAN DO THIS!)
void drawMeta() {
  tft.fillScreen(COLOR_BLACK);
  drawStatusBar();

  // Title
  tft.setTextColor(COLOR_SUNRISE);
  tft.setTextDatum(TC_DATUM);
  tft.drawString("META DASHBOARD", 160, 27, 2);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("All Apps Aggregated", 160, 42, 1);

  // ULTIMATE RECURSION - Pull data from EVERY app!
  int y = 58;
  tft.setTextDatum(TL_DATUM);

  // AI Section (from AI Inference app)
  tft.setTextColor(COLOR_VIVID_PUR);
  tft.drawString("AI:", 10, y, 2);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("5 models, 2847 reqs, 45.2 tok/s", 40, y+3, 1);

  // Messages Section (from Messages app)
  y += 18;
  tft.setTextColor(COLOR_HOT_PINK);
  tft.drawString("MSG:", 10, y, 2);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("3 unread, 24 total today", 48, y+3, 1);

  // CRM Section (from CRM app)
  y += 18;
  tft.setTextColor(COLOR_MAGENTA);
  tft.drawString("CRM:", 10, y, 2);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("$626K pipeline, 33 deals, 12 new", 48, y+3, 1);

  // VPN Section (from Mesh VPN app)
  y += 18;
  tft.setTextColor(COLOR_CYBER_BLUE);
  tft.drawString("VPN:", 10, y, 2);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("4 nodes online (lucidia, octavia...)", 48, y+3, 1);

  // Identity Section (from Identity app)
  y += 18;
  tft.setTextColor(COLOR_SUNRISE);
  tft.drawString("ID:", 10, y, 2);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("alexa@blackroad.io, 2 sessions", 38, y+3, 1);

  // Files Section (from Files app)
  y += 18;
  tft.setTextColor(COLOR_WARM);
  tft.drawString("FILE:", 10, y, 2);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("45 files, 2.3GB total", 50, y+3, 1);

  // APIs Section (from APIs app)
  y += 18;
  tft.setTextColor(COLOR_DEEP_MAG);
  tft.drawString("API:", 10, y, 2);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("382 reqs (/chat:247, /auth:89...)", 48, y+3, 1);

  // CEO Decisions Section (from CEO Core app)
  y += 18;
  tft.setTextColor(COLOR_HOT_PINK);
  tft.drawString("CEO:", 10, y, 2);
  tft.setTextColor(COLOR_WHITE);
  char ceoStats[40];
  sprintf(ceoStats, "âœ…%d âŒ%d â¬†ï¸%d ðŸš€%d", approveCount, rejectCount, escalateCount, shipCount);
  tft.drawString(ceoStats, 48, y+3, 1);

  // Active AI Section (from BlackRoad Chat app)
  y += 18;
  const char* aiNames[] = {"LUCIDIA", "ARIA", "CADENCE", "CECILIA", "OCTAVIA", "ALICE"};
  tft.setTextColor(COLOR_VIVID_PUR);
  tft.drawString("AI:", 10, y, 2);
  tft.setTextColor(COLOR_SUNRISE);
  char aiStatus[30];
  sprintf(aiStatus, "%s active (recursive!)", aiNames[activeAI]);
  tft.drawString(aiStatus, 38, y+3, 1);

  // RECURSION Stats - The META level!
  y += 24;
  tft.fillRoundRect(10, y, 300, 18, 5, COLOR_SUNRISE);
  tft.setTextColor(COLOR_BLACK);
  tft.setTextDatum(TC_DATUM);
  tft.drawString("RECURSION DEPTH: 15 APPS", 160, y+4, 2);

  // Bottom indicator
  tft.setTextColor(COLOR_HOT_PINK); tft.setTextDatum(TC_DATUM);
  tft.drawString("META = ALL DATA", 100, 220, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("|", 180, 220, 1);
  tft.setTextColor(COLOR_VIVID_PUR);
  tft.drawString("ULTIMATE RECURSION!", 260, 220, 1);

  drawBackButton();
}

// RECURSIVE CHAT - Each AI references OTHER apps! (BETTER THAN iPHONE!)
void drawBlackRoadChat() {
  tft.fillScreen(COLOR_BLACK);
  drawStatusBar();

  // Title
  tft.setTextColor(COLOR_HOT_PINK);
  tft.setTextDatum(TC_DATUM);
  tft.drawString("BLACKROAD AI", 160, 27, 2);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("Proprietary Models", 160, 42, 1);

  // 6 TAPPABLE AI Models (highlight active model)
  int y = 56;
  uint16_t colors[] = {COLOR_VIVID_PUR, COLOR_HOT_PINK, COLOR_CYBER_BLUE, COLOR_MAGENTA, COLOR_WARM, COLOR_VIVID_PUR};
  const char* names[] = {"LUCIDIA", "ARIA", "CADENCE", "CECILIA", "OCTAVIA", "ALICE"};
  const char* roles[] = {"Strategic", "Creative", "Workflow", "Analysis", "Security", "Operations"};

  for (int i = 0; i < 6; i++) {
    int x = (i % 2 == 0) ? 8 : 164;
    if (i >= 2 && i % 2 == 0) y += 26;

    // Highlight active model with WHITE outline (RECURSION!)
    if (i == activeAI) {
      tft.drawRoundRect(x-1, y-1, 150, 24, 4, COLOR_WHITE);
    }

    tft.fillRoundRect(x, y, 148, 22, 4, colors[i]);
    tft.setTextColor(COLOR_WHITE); tft.setTextDatum(TL_DATUM);
    tft.drawString(names[i], x+4, y+4, 2);
    tft.setTextDatum(TR_DATUM);
    tft.drawString(roles[i], x+144, y+4, 1);
    tft.setTextColor(COLOR_SUNRISE);
    tft.drawString("ONLINE", x+144, y+13, 1);
  }

  // RECURSIVE CONVERSATIONS - Each AI references OTHER apps!
  y += 34;
  tft.setTextDatum(TL_DATUM);

  // Display conversation based on active AI
  switch (activeAI) {
    case 0: // LUCIDIA - Strategic (references CRM app)
      tft.setTextColor(COLOR_VIVID_PUR);
      tft.drawString("ACTIVE: Lucidia (Strategic)", 10, y, 1);
      y += 14;
      // User: What's priority?
      tft.fillRoundRect(120, y, 190, 18, 5, COLOR_CYBER_BLUE);
      tft.setTextColor(COLOR_WHITE); tft.setTextDatum(TR_DATUM);
      tft.drawString("What's the priority?", 306, y+4, 1);
      y += 22;
      // AI: Focus on $626K pipeline (FROM CRM APP!)
      tft.fillRoundRect(10, y, 250, 18, 5, COLOR_DARK_GRAY);
      tft.setTextColor(COLOR_VIVID_PUR); tft.setTextDatum(TL_DATUM);
      tft.drawString("LUCIDIA:", 14, y+4, 1);
      tft.setTextColor(COLOR_WHITE);
      tft.drawString("Focus on $626K pipeline", 68, y+4, 1);
      y += 22;
      // User: Show deals
      tft.fillRoundRect(150, y, 160, 18, 5, COLOR_CYBER_BLUE);
      tft.setTextColor(COLOR_WHITE); tft.setTextDatum(TR_DATUM);
      tft.drawString("Show top deals", 306, y+4, 1);
      break;

    case 1: // ARIA - Creative (references Messages + Workflow)
      tft.setTextColor(COLOR_HOT_PINK);
      tft.drawString("ACTIVE: Aria (Creative)", 10, y, 1);
      y += 14;
      tft.fillRoundRect(120, y, 190, 18, 5, COLOR_CYBER_BLUE);
      tft.setTextColor(COLOR_WHITE); tft.setTextDatum(TR_DATUM);
      tft.drawString("Design ideas?", 306, y+4, 1);
      y += 22;
      tft.fillRoundRect(10, y, 270, 18, 5, COLOR_DARK_GRAY);
      tft.setTextColor(COLOR_HOT_PINK); tft.setTextDatum(TL_DATUM);
      tft.drawString("ARIA:", 14, y+4, 1);
      tft.setTextColor(COLOR_WHITE);
      tft.drawString("Check Messages: 3 unread ideas", 48, y+4, 1);
      y += 22;
      tft.fillRoundRect(100, y, 210, 18, 5, COLOR_CYBER_BLUE);
      tft.setTextColor(COLOR_WHITE); tft.setTextDatum(TR_DATUM);
      tft.drawString("What about workflow?", 306, y+4, 1);
      break;

    case 2: // CADENCE - Workflow (references CEO Core + Workflow app)
      tft.setTextColor(COLOR_CYBER_BLUE);
      tft.drawString("ACTIVE: Cadence (Workflow)", 10, y, 1);
      y += 14;
      tft.fillRoundRect(100, y, 210, 18, 5, COLOR_CYBER_BLUE);
      tft.setTextColor(COLOR_WHITE); tft.setTextDatum(TR_DATUM);
      tft.drawString("Next workflow task?", 306, y+4, 1);
      y += 22;
      tft.fillRoundRect(10, y, 280, 18, 5, COLOR_DARK_GRAY);
      tft.setTextColor(COLOR_CYBER_BLUE); tft.setTextDatum(TL_DATUM);
      tft.drawString("CADENCE:", 14, y+4, 1);
      tft.setTextColor(COLOR_WHITE);
      tft.drawString("CEO approved 9 items. Ship next!", 72, y+4, 1);
      y += 22;
      tft.fillRoundRect(150, y, 160, 18, 5, COLOR_CYBER_BLUE);
      tft.setTextColor(COLOR_WHITE); tft.setTextDatum(TR_DATUM);
      tft.drawString("Show status", 306, y+4, 1);
      break;

    case 3: // CECILIA - Analysis (references APIs + Files)
      tft.setTextColor(COLOR_MAGENTA);
      tft.drawString("ACTIVE: Cecilia (Analysis)", 10, y, 1);
      y += 14;
      tft.fillRoundRect(130, y, 180, 18, 5, COLOR_CYBER_BLUE);
      tft.setTextColor(COLOR_WHITE); tft.setTextDatum(TR_DATUM);
      tft.drawString("Data summary?", 306, y+4, 1);
      y += 22;
      tft.fillRoundRect(10, y, 280, 18, 5, COLOR_DARK_GRAY);
      tft.setTextColor(COLOR_MAGENTA); tft.setTextDatum(TL_DATUM);
      tft.drawString("CECILIA:", 14, y+4, 1);
      tft.setTextColor(COLOR_WHITE);
      tft.drawString("APIs: 382 reqs, Files: 45 (2.3GB)", 68, y+4, 1);
      y += 22;
      tft.fillRoundRect(110, y, 200, 18, 5, COLOR_CYBER_BLUE);
      tft.setTextColor(COLOR_WHITE); tft.setTextDatum(TR_DATUM);
      tft.drawString("Breakdown by endpoint", 306, y+4, 1);
      break;

    case 4: // OCTAVIA - Security (references VPN + Identity)
      tft.setTextColor(COLOR_WARM);
      tft.drawString("ACTIVE: Octavia (Security)", 10, y, 1);
      y += 14;
      tft.fillRoundRect(120, y, 190, 18, 5, COLOR_CYBER_BLUE);
      tft.setTextColor(COLOR_WHITE); tft.setTextDatum(TR_DATUM);
      tft.drawString("Security status?", 306, y+4, 1);
      y += 22;
      tft.fillRoundRect(10, y, 300, 18, 5, COLOR_DARK_GRAY);
      tft.setTextColor(COLOR_WARM); tft.setTextDatum(TL_DATUM);
      tft.drawString("OCTAVIA:", 14, y+4, 1);
      tft.setTextColor(COLOR_WHITE);
      tft.drawString("VPN: 4 nodes online, ID: 2 sessions", 68, y+4, 1);
      y += 22;
      tft.fillRoundRect(150, y, 160, 18, 5, COLOR_CYBER_BLUE);
      tft.setTextColor(COLOR_WHITE); tft.setTextDatum(TR_DATUM);
      tft.drawString("All secure?", 306, y+4, 1);
      break;

    case 5: // ALICE - Operations (references Settings + SSH nodes)
      tft.setTextColor(COLOR_VIVID_PUR);
      tft.drawString("ACTIVE: Alice (Operations)", 10, y, 1);
      y += 14;
      tft.fillRoundRect(120, y, 190, 18, 5, COLOR_CYBER_BLUE);
      tft.setTextColor(COLOR_WHITE); tft.setTextDatum(TR_DATUM);
      tft.drawString("System health?", 306, y+4, 1);
      y += 22;
      tft.fillRoundRect(10, y, 290, 18, 5, COLOR_DARK_GRAY);
      tft.setTextColor(COLOR_VIVID_PUR); tft.setTextDatum(TL_DATUM);
      tft.drawString("ALICE:", 14, y+4, 1);
      tft.setTextColor(COLOR_WHITE);
      tft.drawString("5 SSH nodes, WiFi connected, 75%", 54, y+4, 1);
      y += 22;
      tft.fillRoundRect(130, y, 180, 18, 5, COLOR_CYBER_BLUE);
      tft.setTextColor(COLOR_WHITE); tft.setTextDatum(TR_DATUM);
      tft.drawString("Check node status", 306, y+4, 1);
      break;
  }

  // Bottom stats - RECURSION indicator
  tft.setTextColor(COLOR_HOT_PINK); tft.setTextDatum(TC_DATUM);
  tft.drawString("6 MODELS", 80, 220, 1);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("|", 135, 220, 1);
  tft.setTextColor(COLOR_VIVID_PUR);
  tft.drawString("TAP=SWITCH", 200, 220, 1);
  tft.setTextColor(COLOR_MAGENTA);
  tft.drawString("| RECURSIVE!", 280, 220, 1);

  drawBackButton();
}

void drawCurrentScreen() {
  switch (currentScreen) {
    case SCREEN_LOCK:
      drawLockScreen();
      break;
    case SCREEN_HOME:
      drawHomeScreen();
      break;
    case SCREEN_AI_INFERENCE:
      drawAIInference();
      break;
    case SCREEN_MESSAGES:
      drawMessagesScreen();
      break;
    case SCREEN_CRM:
      drawCRMScreen();
      break;
    case SCREEN_MESH_VPN:
      drawMeshVPN();
      break;
    case SCREEN_IDENTITY:
      drawIdentity();
      break;
    case SCREEN_FILES:
      drawFiles();
      break;
    case SCREEN_APIS:
      drawAPIs();
      break;
    case SCREEN_SETTINGS:
      drawSettingsScreen();
      break;
    case SCREEN_CONTROL_CENTER:
      drawControlCenter();
      break;
    case SCREEN_WORKFLOW:
      drawWorkflow();
      break;
    case SCREEN_DECISIONS:
      drawDecisions();
      break;
    case SCREEN_CEO_DASHBOARD:
      drawCEODashboard();
      break;
    case SCREEN_CEO_CORE:
      drawCEOCore();
      break;
    case SCREEN_EXEC_GRID:
      drawExecGrid();
      break;
    case SCREEN_META:
      drawMeta();
      break;
    case SCREEN_BLACKROAD_CHAT:
      drawBlackRoadChat();
      break;
    case SCREEN_TERMINAL:
      drawTerminal();
      break;
    case SCREEN_KEYBOARD:
      drawKeyboard();
      break;
    default:
      drawHomeScreen();
  }
}

// Handle touch events
void handleTouch() {
  int x, y;

  if (!getTouchCoordinates(x, y)) {
    return;
  }

  // Debounce
  if (millis() - lastTouchTime < 200) {
    return;
  }
  lastTouchTime = millis();

  Serial.printf("Touch at x:%d, y:%d on screen:%d\n", x, y, currentScreen);

  switch (currentScreen) {
    case SCREEN_LOCK:
      // Any touch unlocks (tap anywhere on screen)
      Serial.println("Unlocking...");
      currentScreen = SCREEN_HOME;
      drawCurrentScreen();
      break;

    case SCREEN_HOME:
      // Check app icons
      for (int i = 0; i < APP_COUNT; i++) {
        if (x >= apps[i].x && x <= apps[i].x + apps[i].size &&
            y >= apps[i].y && y <= apps[i].y + apps[i].size) {
          // Visual feedback
          drawAppIcon(apps[i], true);
          delay(100);

          currentScreen = apps[i].screen;
          drawCurrentScreen();
          break;
        }
      }
      break;

    case SCREEN_CEO_CORE:
      // Check back button FIRST
      if (x >= 5 && x <= 80 && y >= 0 && y <= 30) {
        Serial.println("Back button tapped - returning to home");
// REMOVED - CAUSES CRASH:         drawBackButton(true); // Pressed state
        delay(100); // Visual feedback
        playBeep();
        currentScreen = SCREEN_HOME;
        drawCurrentScreen();
        break;
      }

      // 3Ã—3 CEO CORE Grid (80Ã—80 buttons, no gaps)
      {
        int startX = 40;
        int startY = 50;
        int btnSize = 80;

        // Determine which button was tapped
        int col = (x - startX) / btnSize;
        int row = (y - startY) / btnSize;

        if (col >= 0 && col < 3 && row >= 0 && row < 3) {
          lastActionTime = millis();

          // ROW 0 buttons
          if (row == 0) {
            if (col == 0) { // REJECT
              rejectCount++;
              playCritical();
              Serial.println("âŒ REJECT - Count: " + String(rejectCount));
            } else if (col == 1) { // HOLD
              holdCount++;
              playBeep();
              Serial.println("ðŸ’­ HOLD - Count: " + String(holdCount));
            } else if (col == 2) { // APPROVE
              approveCount++;
              playSuccess();
              Serial.println("âœ… APPROVE - Count: " + String(approveCount));
            }
          }
          // ROW 1 buttons
          else if (row == 1) {
            if (col == 0) { // BLOCKED
              blockedCount++;
              playCritical();
              Serial.println("ðŸ§± BLOCKED - Count: " + String(blockedCount));
            } else if (col == 1) { // BRAIN (next decision)
              playBeep(100);
              Serial.println("ðŸ§  BRAIN - Loading next decision...");
            } else if (col == 2) { // NEXT
              playBeep();
              Serial.println("ðŸ”œ NEXT - Moving to next item");
            }
          }
          // ROW 2 buttons
          else if (row == 2) {
            if (col == 0) { // CRITICAL
              criticalCount++;
              playCritical();
              Serial.println("ðŸ”¥ CRITICAL - Count: " + String(criticalCount));
            } else if (col == 1) { // ESCALATE
              escalateCount++;
              playSuccess();
              Serial.println("ðŸªœ ESCALATE - Count: " + String(escalateCount));
            } else if (col == 2) { // SHIP
              shipCount++;
              playSuccess();
              Serial.println("ðŸš€ SHIP - Count: " + String(shipCount));
            }
          }

          // Flash the button (visual feedback)
          delay(100);
          drawCEOCore();
        }
      }
      break;

    case SCREEN_EXEC_GRID:
      // Check back button FIRST
      if (x >= 5 && x <= 80 && y >= 0 && y <= 30) {
        Serial.println("Back button tapped - returning to home");
// REMOVED - CAUSES CRASH:         drawBackButton(true); // Pressed state
        delay(100); // Visual feedback
        playBeep();
        currentScreen = SCREEN_HOME;
        drawCurrentScreen();
        break;
      }

      // 4Ã—4 EXEC Grid (60Ã—60 buttons, 2px gaps)
      {
        int startX = 50;
        int startY = 50;
        int btnSize = 60;
        int gap = 2;

        int col = (x - startX) / (btnSize + gap);
        int row = (y - startY) / (btnSize + gap);

        if (col >= 0 && col < 4 && row >= 0 && row < 4) {
          lastActionTime = millis();
          playBeep();

          // Map grid position to action
          String actions[4][4] = {
            {"REJECT", "HOLD", "BRAIN", "APPROVE"},
            {"BLOCKED", "RISK", "CRITICAL", "NEXT"},
            {"USER", "TEAM", "ESCALATE", "DIRECTION"},
            {"VOICE", "DATA", "LOOP", "SHIP"}
          };

          String action = actions[row][col];
          Serial.println("EXEC 4Ã—4 - " + action + " activated");

          // Update counts for matching actions
          if (action == "APPROVE") {approveCount++; playSuccess();}
          else if (action == "REJECT") {rejectCount++; playCritical();}
          else if (action == "HOLD") {holdCount++;}
          else if (action == "SHIP") {shipCount++; playSuccess();}
          else if (action == "ESCALATE") {escalateCount++;}
          else if (action == "CRITICAL") {criticalCount++; playCritical();}
          else if (action == "BLOCKED") {blockedCount++;}

          delay(100);
          drawExecGrid();
        }
      }
      break;

    case SCREEN_BLACKROAD_CHAT:
      // Check back button FIRST
      if (x >= 5 && x <= 80 && y >= 0 && y <= 30) {
        Serial.println("Back button tapped - returning to home");
// REMOVED - CAUSES CRASH:         drawBackButton(true); // Pressed state
        delay(100); // Visual feedback
        playBeep();
        currentScreen = SCREEN_HOME;
        drawCurrentScreen();
        break;
      }

      // RECURSIVE AI MODEL SELECTION - Tap any model to switch! (BETTER THAN iPHONE!)
      // 6 AI models in 2Ã—3 grid (148Ã—22px each)
      // Row 1 (y=56-78): LUCIDIA (x=8-156), ARIA (x=164-312)
      // Row 2 (y=82-104): CADENCE (x=8-156), CECILIA (x=164-312)
      // Row 3 (y=108-130): OCTAVIA (x=8-156), ALICE (x=164-312)

      {
        const char* names[] = {"LUCIDIA", "ARIA", "CADENCE", "CECILIA", "OCTAVIA", "ALICE"};
        int tappedAI = -1;

        // Row 1 (y=56-78)
        if (y >= 56 && y <= 78) {
          if (x >= 8 && x <= 156) tappedAI = 0; // LUCIDIA
          else if (x >= 164 && x <= 312) tappedAI = 1; // ARIA
        }
        // Row 2 (y=82-104)
        else if (y >= 82 && y <= 104) {
          if (x >= 8 && x <= 156) tappedAI = 2; // CADENCE
          else if (x >= 164 && x <= 312) tappedAI = 3; // CECILIA
        }
        // Row 3 (y=108-130)
        else if (y >= 108 && y <= 130) {
          if (x >= 8 && x <= 156) tappedAI = 4; // OCTAVIA
          else if (x >= 164 && x <= 312) tappedAI = 5; // ALICE
        }

        if (tappedAI != -1) {
          activeAI = tappedAI;
          playBeep();
          Serial.printf("ðŸ”„ RECURSION! Switched to %s (AI #%d)\n", names[tappedAI], tappedAI);
          Serial.println("ðŸ’¡ AI now references different apps!");
          drawCurrentScreen(); // Redraw with new AI conversation
        }
      }
      break;

    case SCREEN_TERMINAL:
      // Check back button FIRST
      if (x >= 5 && x <= 80 && y >= 0 && y <= 30) {
        Serial.println("Back button tapped - returning to home");
// REMOVED - CAUSES CRASH:         drawBackButton(true); // Pressed state
        delay(100); // Visual feedback
        playBeep();
        currentScreen = SCREEN_HOME;
        drawCurrentScreen();
        break;
      }

      // KEYBOARD button (tappable area: x=200-310, y=215-235)
      if (x >= 200 && x <= 310 && y >= 215 && y <= 235) {
        Serial.println("âŒ¨ Opening keyboard...");
        playBeep();
        screenBeforeKeyboard = SCREEN_TERMINAL;
        currentScreen = SCREEN_KEYBOARD;
        drawCurrentScreen();
        break;
      }
      break;

    case SCREEN_KEYBOARD:
      {
        // QWERTY keyboard touch handling (BETTER THAN iPHONE!)
        const char* row1 = "QWERTYUIOP";
        const char* row2 = "ASDFGHJKL";
        const char* row3 = "ZXCVBNM";

        int keyWidth = 28;
        int keyHeight = 24;
        int keySpacing = 2;

        bool keyPressed = false;

        // Row 1 (10 keys, y=123-147)
        if (y >= 123 && y <= 147) {
          int startX = 10;
          for (int i = 0; i < 10; i++) {
            int keyX = startX + i * (keyWidth + keySpacing);
            if (x >= keyX && x <= keyX + keyWidth) {
              terminalBuffer += row1[i];
              playBeep();
              Serial.printf("âŒ¨ Key pressed: %c\n", row1[i]);
              keyPressed = true;
              break;
            }
          }
        }

        // Row 2 (9 keys, y=151-175, centered at x=25)
        if (!keyPressed && y >= 151 && y <= 175) {
          int startX = 25;
          for (int i = 0; i < 9; i++) {
            int keyX = startX + i * (keyWidth + keySpacing);
            if (x >= keyX && x <= keyX + keyWidth) {
              terminalBuffer += row2[i];
              playBeep();
              Serial.printf("âŒ¨ Key pressed: %c\n", row2[i]);
              keyPressed = true;
              break;
            }
          }
        }

        // Row 3 (7 keys, y=179-203, centered at x=55)
        if (!keyPressed && y >= 179 && y <= 203) {
          int startX = 55;
          for (int i = 0; i < 7; i++) {
            int keyX = startX + i * (keyWidth + keySpacing);
            if (x >= keyX && x <= keyX + keyWidth) {
              terminalBuffer += row3[i];
              playBeep();
              Serial.printf("âŒ¨ Key pressed: %c\n", row3[i]);
              keyPressed = true;
              break;
            }
          }
        }

        // Bottom row (y=207-231)
        if (!keyPressed && y >= 207 && y <= 231) {
          // SPACE (x=10-110)
          if (x >= 10 && x <= 110) {
            terminalBuffer += ' ';
            playBeep();
            Serial.println("âŒ¨ SPACE pressed");
            keyPressed = true;
          }
          // BACKSPACE (x=115-175)
          else if (x >= 115 && x <= 175) {
            if (terminalBuffer.length() > 0) {
              terminalBuffer.remove(terminalBuffer.length() - 1);
              playBeep();
              Serial.println("âŒ¨ BACKSPACE pressed");
              keyPressed = true;
            }
          }
          // ENTER (x=180-230)
          else if (x >= 180 && x <= 230) {
            playSuccess();
            Serial.printf("âŒ¨ ENTER pressed - Command: %s\n", terminalBuffer.c_str());

            // Add command to history
            if (terminalBuffer.length() > 0) {
              // Shift history up
              for (int i = 0; i < 7; i++) {
                terminalHistory[i] = terminalHistory[i+1];
              }
              // Add new command and placeholder output
              terminalHistory[6] = "$ " + terminalBuffer;
              terminalHistory[7] = "> [Command executed]";
              historyCount = 8;

              // Clear buffer
              terminalBuffer = "";
            }

            // Close keyboard and return to terminal
            currentScreen = screenBeforeKeyboard;
            drawCurrentScreen();
            keyPressed = true;
          }
          // DONE (x=235-310)
          else if (x >= 235 && x <= 310) {
            playBeep();
            Serial.println("âŒ¨ DONE pressed - closing keyboard");
            currentScreen = screenBeforeKeyboard;
            drawCurrentScreen();
            keyPressed = true;
          }
        }

        // Redraw keyboard to show updated buffer
        if (keyPressed) {
          drawCurrentScreen();
        }
      }
      break;

    default:
      // Back button (universal) - larger hit area for better touch response
      if (x >= 5 && x <= 80 && y >= 0 && y <= 30) {
        Serial.println("Back button tapped - returning to home");
// REMOVED - CAUSES CRASH:         drawBackButton(true); // Pressed state
        delay(100); // Visual feedback
        playBeep();
        currentScreen = SCREEN_HOME;
        drawCurrentScreen();
      }
  }

  // Wait for release
  while (digitalRead(XPT2046_IRQ) == LOW) {
    delay(10);
  }
}

void connectWiFi() {
  tft.fillScreen(COLOR_BLACK);
  tft.setTextColor(COLOR_SUNRISE);
  tft.setTextDatum(MC_DATUM);
  tft.drawString("BLACKROAD AI", 160, 80, 4);
  tft.setTextColor(COLOR_WHITE);
  tft.drawString("Initializing...", 160, 120, 2);

  WiFi.setHostname(DEVICE_NAME);
  WiFi.mode(WIFI_STA);
  WiFi.begin(WIFI_SSID, WIFI_PASSWORD);

  int attempt = 0;
  while (WiFi.status() != WL_CONNECTED && attempt < 20) {
    delay(500);
    Serial.print(".");
    attempt++;
  }

  if (WiFi.status() == WL_CONNECTED) {
    Serial.println("\nWiFi Connected!");
    Serial.print("IP: ");
    Serial.println(WiFi.localIP());

    tft.fillScreen(COLOR_BLACK);
    tft.setTextColor(COLOR_VIVID_PUR);
    tft.setTextDatum(MC_DATUM);
    tft.drawString("CONNECTED", 160, 100, 4);
    tft.setTextColor(COLOR_WHITE);
    tft.drawString(WiFi.localIP().toString(), 160, 130, 2);
    delay(2000);
  } else {
    Serial.println("\nWiFi Failed - Running Offline");
    tft.fillScreen(COLOR_BLACK);
    tft.setTextColor(COLOR_HOT_PINK);
    tft.setTextDatum(MC_DATUM);
    tft.drawString("OFFLINE MODE", 160, 100, 4);
    delay(2000);
  }
}

void setup() {
  Serial.begin(115200);
  delay(100);
  Serial.println("\n\n=================================");
  Serial.println("BLACKROAD AI PHONE OS");
  Serial.println("ESP32 Native AI Operating System");
  Serial.println("=================================");

  // Turn on backlight
  pinMode(TFT_BL, OUTPUT);
  digitalWrite(TFT_BL, HIGH);

  // Initialize haptic/audio feedback (BETTER THAN iPHONE!)
  pinMode(BUZZER_PIN, OUTPUT);
  playSuccess();  // Boot sound

  // Initialize display
  tft.init();
  tft.setRotation(1); // Landscape mode (320x240)
  tft.fillScreen(COLOR_BLACK);

  Serial.println("Display initialized");

  // Initialize touch SPI
  touchSPI.begin(XPT2046_CLK, XPT2046_MISO, XPT2046_MOSI, XPT2046_CS);
  pinMode(XPT2046_CS, OUTPUT);
  pinMode(XPT2046_IRQ, INPUT);
  digitalWrite(XPT2046_CS, HIGH);

  Serial.println("Touch initialized");

  // Connect to WiFi
  connectWiFi();

  // Show lock screen
  currentScreen = SCREEN_LOCK;
  drawCurrentScreen();

  Serial.println("\nBlackRoad AI Phone Ready!");
  Serial.println("Tap screen to unlock and start using your AI Phone!");
}

void loop() {
  handleTouch();
  delay(10);
}
